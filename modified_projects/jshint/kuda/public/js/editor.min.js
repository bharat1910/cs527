/* jshint undef: true, unused: true */
var editor={};(function(a,b,c){function h(){b.core.client&&b.core.client.cleanup()}function g(){b.subscribe(b.msg.worldCleanup,function(b){a.notifyListeners(a.events.WorldCleaned)}),b.subscribe(b.msg.ready,function(){a.notifyListeners(a.events.WorldLoaded),a.projects.loadingDone()})}function f(){a.client=b.makeClients({resizeHandler:a.ui.resizeView})[0],g(),a.ui.initializeView(a.client),a.projects.init(),a.plugins.init()}"use strict";var d=function(){this.worldSpecs=new b.utils.Hashtable,this.editorSpecs=null};d.prototype={swap:function(){this.editorSpecs===null&&(this.editorSpecs=b._resetMsgSpecs(this.worldSpecs))},unswap:function(){this.editorSpecs!==null&&(b._resetMsgSpecs(this.editorSpecs),this.editorSpecs=null)},getTargetSpec:function(a){this.swap();var c=b.dispatch.getTargetSpec(a);this.unswap();return c},getTargets:function(a,c){this.swap();var d=b.dispatch.getTargets(a,c);this.unswap();return d},registerTarget:function(a,c,d,e,f){this.swap();var g=b.dispatch.registerTarget(a,c,d,e,f);this.unswap();return g},removeTarget:function(a,c){this.swap();var d=b.dispatch.removeTarget(a,c);this.unswap();return d},cleanup:function(){this.swap(),b.dispatch.cleanup(),this.unswap()},toOctane:function(){this.swap();var a=b.dispatch.toOctane();this.unswap();return a}};var e=new d;a.getActivePlugins=function(){return activePlugins},a.getActiveTool=function(){var b=a.getViews();for(var c=0,d=b.length;c<d;c++){var e=b[c];if(e.mode===a.ToolConstants.MODE_DOWN)return e}return null},a.getCss=function(a,b){c(document.createElement("link")).attr({href:a,media:b||"screen",type:"text/css",rel:"stylesheet"}).appendTo("head")},a.getDispatchProxy=function(){return e},a.getProjectOctane=function(){e.swap();var c=b.world.toOctane(function(b){return b.name.search(a.ToolConstants.EDITOR_PREFIX)===-1});e.unswap();return c},a.getScript=function(b,c){var d=document.createElement("script");d.type="text/javascript",d.src=b,a.notifyListeners(a.events.ScriptLoadStart,b);var e=!1;d.onload=d.onreadystatechange=function(){!e&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")&&(e=!0,c&&c(),a.notifyListeners(a.events.ScriptLoaded,b),d.onload=d.onreadystatechange=null)},document.body.appendChild(d)},window.onload=function(){f()}})(editor,hemi,jQuery),function(a){a.events={Cancel:"editor.Cancel",ColorPicked:"editor.ColorPicked",Created:"editor.Created",Edit:"editor.Edit",Editing:"editor.Editing",Enabled:"editor.Enabled",Invalidate:"editor.Invalidate",Loaded:"editor.Loaded",MenuItemClicked:"editor.MenuItemClicked",ModelAdded:"editor.ModelAdded",PanelVisible:"editor.PanelVisible",PluginLoaded:"editor.PluginLoaded",PluginRemoved:"editor.PluginRemoved",Remove:"editor.Remove",Removing:"editor.Removing",Save:"editor.Save",ScriptLoaded:"editor.ScriptLoaded",ScriptLoadStart:"editor.ScriptLoadStart",SidebarSet:"editor.SidebarSet",ToolClicked:"editor.ToolClicked",ToolModeSet:"editor.ToolModeSet",ToolMouseIn:"editor.ToolMouseIn",ToolMouseOut:"editor.ToolMouseOut",Updated:"editor.Updated",ViewAdded:"editor.ViewAdded",WidgetVisible:"editor.WidgetVisible",WorldCleaned:"editor.WorldCleaned",WorldLoaded:"editor.WorldLoaded"}}(editor),function(a){"use strict",a.utils=a.utils||{};var b=a.utils.Listenable=function(){this.listeners=new Hashtable};b.prototype.addListener=function(a,b){var c=this.listeners.get(a);c||(c=[]);var d=c.indexOf(b);d==-1&&c.push(b),this.listeners.put(a,c)},b.prototype.removeListener=function(a){var b=null;if(this.listeners.containsValue(a)){var c=this.listeners.keys();for(var d=0,e=c.length;d<e&&!b;d++){var f=this.listeners.get(c[d]),g=f.indexOf(a);if(g!=-1){var h=f.splice(g,1);h.length==1&&(b=h[0])}}}return b},b.prototype.notifyListeners=function(a,b){var c=this.listeners.get(a);if(c)for(var d=0,e=c.length;d<e;d++){var f=c[d],g=jQuery.isFunction(f);g?f(b):f.notify(a,b)}};var c=new a.utils.Listenable;a.addListener=function(a,b){c.addListener(a,b)},a.notifyListeners=function(a,b){c.notifyListeners(a,b)},a.removeListener=function(a){c.removeListener(a)}}(editor),function(a){"use strict",a.utils=a.utils||{},a.utils.roundNumber=function(a,b){var c=Math.round(a*Math.pow(10,b))/Math.pow(10,b);return c},a.utils.getFunctionParams=function(a){return a.toString().match(/\((.*?)\)/)[1].match(/[\w]+/g)||[]}}(editor),function(a){function c(a){var b="";for(var c=0,d=a.length;c<d;++c){var e=a[c],f=e.name,g;e._octaneType?g=e._octaneType.split(".").pop():g="Behavior",c!==0&&(b+=", <br>"),b+=f+" ("+g+")"}return b}"use strict",a.depends=a.depends||{};var b=function(){this.depends=new Hashtable};b.prototype.addDependency=function(a,b){var c=this.getDependencies(b);c.indexOf(a)===-1&&c.push(a),this.depends.put(b._getId(),c)},b.prototype.clearDependencies=function(a){a._getId&&this.depends.remove(a._getId())},b.prototype.getDependencies=function(a,b){var c=this.depends.get(a._getId())||[];if(b)for(var d=0;d<c.length;++d){var e=c[d];if(e._getId){var f=this.depends.get(e._getId())||[];for(var g=0,h=f.length;g<h;++g)gc=f[g],c.indexOf(gc)===-1&&c.push(gc)}}return c},b.prototype.removeDependency=function(a,b){var c=this.getDependencies(b),d=c.indexOf(a);d!==-1&&c.splice(d,1)},b.prototype.resetDependencies=function(a){this.depends.each(function(b,c){var d=c.indexOf(a);d!==-1&&c.splice(d,1)})};var d=new b;a.addListener(a.events.PluginLoaded,function(b){var c=a.getModel(b);c&&c.addListener(a.events.Removing,function(a){d.clearDependencies(a)})}),a.depends.add=function(a,b){a&&b&&d.addDependency(a,b)},a.depends.check=function(b){var e=d.getDependencies(b,!0),f=e.length===0;if(!f){var g=c(e),h=a.ui.createDependencyDialog(g);h.dialog("open")}return f},a.depends.clear=function(a){d.clearDependencies(a)},a.depends.remove=function(a,b){a&&b&&d.removeDependency(a,b)},a.depends.reset=function(a){d.resetDependencies(a)};return a}(editor||{}),function(){function d(a){var b=a.join("."),c=this.types.get(b);c==null&&(c=this.functions.get(b)),c==null&&(c=this.parameters.get(b));return c}function c(){var a=this;this.types=new Hashtable,this.functions=new Hashtable,this.parameters=new Hashtable,this.messages=new Hashtable;try{hemi.loadHtml("js/editor/data/hemi.json",function(b){var c=JSON.parse(b);for(var d=0,e=c.length;d<e;d++){var f=c[d],g=f.name,h=f.funcs,i=f.msgs,j={description:f.desc,methods:[],parent:f.parent};a.types.put(g,j);for(var k=0,l=h.length;k<l;k++){var m=h[k],n=m.name,o=m.params,p={description:m.desc,parameters:[]};j.methods.push(n),a.functions.put(g+"."+n,p);for(var q=0,r=o.length;q<r;q++){var s=o[q],t=s.name;p.parameters.push(t),a.parameters.put(g+"."+n+"."+t,{description:s.desc,type:s.type})}}for(var k=0,l=i.length;k<l;++k){var u=i[k];a.messages.put(g+"."+u.name,u.desc)}}})}catch(b){console.log(b)}}"use strict";var a=editor.data={},b=function(){c.call(this)};b.prototype.getDescription=function(a,b,c){var e=this.getParent(a),f=[];for(var g=0,h=arguments.length;g<h;++g)f[g]=arguments[g];var i=d.call(this,f);while(i==null&&e!=null)f[0]=e,e=this.getParent(e),i=d.call(this,f);return i==null?null:i.description},b.prototype.getMsgDescription=function(a,b){var c=this.getParent(a),d=this.messages.get(a+"."+b);while(d==null&&c!=null)d=this.messages.get(c+"."+b),c=this.getParent(c);return d},b.prototype.getMethods=function(a){var b=[];while(a!=null){var c=this.types.get(a);c?(b=b.concat(c.methods),a=c.parent):a=null}return b},b.prototype.getParameters=function(a,b){var c=this.functions.get(a+"."+b),d=this.getParent(a);while(c==null&&d!=null)c=this.functions.get(d+"."+b),d=this.getParent(d);return c?c.parameters:null},b.prototype.getParent=function(a){var b=this.types.get(a);return b?b.parent:null},b.prototype.getType=function(a,b,c){var e=this.getParent(a),f=[];for(var g=0,h=arguments.length;g<h;++g)f[g]=arguments[g];var i=d.call(this,f);while(i==null&&e!=null)f[0]=e,e=this.getParent(e),i=d.call(this,f);return i==null?null:i.type};var e=new b;a.getMetaData=function(){return e}}(),function(a){"use strict",a.ui=a.ui||{},a.ui.ComponentDefaults={uiFile:null,showOptions:null,hideOptions:null};var b=a.ui.Component=function(b){a.utils.Listenable.call(this),this.config=jQuery.extend({},a.ui.ComponentDefaults,b),this.container=null,this.visible===undefined&&(this.visible=!1),this.config.uiFile&&this.config.uiFile!==""?this.load():(this.layout(),this.finishLayout(),this.notifyListeners(a.events.Loaded))};b.prototype=new a.utils.Listenable,b.prototype.constructor=b,b.prototype.layout=function(){},b.prototype.finishLayout=function(){},b.prototype.load=function(){var b=this;this.container=jQuery("<div></div>"),this.config.uiFile&&this.config.uiFile!==""&&hemi.loadHtml(this.config.uiFile,function(c){var d=c.replace(/<!--(.|\s)*?-->/,"");b.container.append(jQuery(d)),b.layout(),b.finishLayout(),b.notifyListeners(a.events.Loaded)})},b.prototype.getUI=function(){return this.container},b.prototype.setVisible=function(a){a?this.container.show(this.config.showOptions):this.container.hide(this.config.hideOptions)},b.prototype.isVisible=function(){return this.container.is(":visible")},b.prototype.find=function(a){return this.container.find(a)}}(editor),function(a){function e(a,b){if(b==null)switch(a.config.type){case"boolean":a.container.find('input[value="false"]').attr("checked",!0);break;default:a.container.val("")}else switch(a.config.type){case"boolean":a.container.find('input[value="'+(b?"true":"false")+'"]').attr("checked",!0);break;case"angle":var c=hemi.RAD_TO_DEG*b;a.container.val(c);break;default:a.container.val(b)}}function d(a){var b;switch(a.config.type){case"number":b=parseFloat(a.container.val()),isNaN(b)&&(b=null);break;case"integer":b=parseInt(a.container.val()),isNaN(b)&&(b=null);break;case"boolean":b=a.container.find("input:radio:checked").val()==="true";break;case"angle":var c=parseFloat(a.container.val());b=hemi.DEG_TO_RAD*c,isNaN(b)&&(b=null);break;default:b=a.container.val(),b===""&&(b=null)}return b}"use strict",a.ui=a.ui||{};var b={container:null,inputClass:null,onBlur:null,placeHolder:null,type:"number",validator:null,name:null},c=a.ui.Input=function(c){var d=jQuery.extend({},b,c);this.value=null,a.ui.Component.call(this,d)};c.prototype=new a.ui.Component,c.prototype.constructor=c,c.prototype.layout=function(){var a=this,b=this.config;if(b.container)this.container=b.container,b.placeHolder||(b.placeHolder=this.container.attr("placeholder"));else switch(b.type){case"boolean":this.container=jQuery('<div><form><input type="radio" name="'+b.name+'" value="true" /> true'+'<input type="radio" name="'+b.name+'" value="false" /> false'+"</form></div>");break;default:this.container=jQuery('<input type="text" />')}b.placeHolder&&this.container.attr("placeholder",b.placeHolder),b.inputClass&&this.container.attr("class",b.inputClass),b.validator&&b.validator.setElements(this.container),this.container.attr("autocomplete","off"),this.container.bind("blur",function(b){var c=d(a);a.setValue(c),a.config.onBlur&&a.config.onBlur(a,b)}).bind("focus",function(b){e(a,a.value)})},c.prototype.getValue=function(){return this.container.is(":focus")||this.config.type==="boolean"?d(this):this.value},c.prototype.reset=function(){this.value=null,e(this,null)},c.prototype.setName=function(a){this.config.placeHolder=a,this.container.attr("placeholder",a),this.setValue(this.value)},c.prototype.setType=function(a){this.config.type=a},c.prototype.setValue=function(a){if(!this.container.is(":focus"))if(a==null)this.reset();else{this.value=a;switch(this.config.type){case"boolean":this.container.find('input[value="'+(a?"true":"false")+'"]').attr("checked",!0);break;case"angle":a=hemi.RAD_TO_DEG*a;default:this.config.placeHolder?this.container.val(this.config.placeHolder+": "+a):this.container.val(a)}}}}(editor),function(a){"use strict",a.ui=a.ui||{},a.ui.Constants=a.ui.Constants||{},a.ui.Constants.UP_STATE="UP",a.ui.Constants.DOWN_STATE="DOWN",a.ui.MenuItemDefaults={title:null,action:null,stateful:!1,stateDownClass:"down",stateUpClass:"up"};var b=a.ui.MenuItem=function(b){var c=jQuery.extend({},a.ui.MenuItemDefaults,b);a.ui.Component.call(this,c),this.stateful=c.stateful,this.setState(a.ui.Constants.UP_STATE),this.downClass=c.stateDownClass,this.upClass=c.stateUpClass};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){this.container=jQuery("<a></a>"),this.config.title&&this.setTitle(this.config.title),this.config.action&&this.setAction(this.config.action)},b.prototype.setTitle=function(a){this.container.text(a)},b.prototype.setKeyboardShortcut=function(a){},b.prototype.setAction=function(b){var c=this;this.container.bind("click",function(d){b(d),c.notifyListeners(a.events.MenuItemClicked,c),c.toggleState()})},b.prototype.setState=function(b){if(this.stateful)if(b==a.ui.Constants.DOWN_STATE||b==a.ui.Constants.UP_STATE){var c,d;b==a.ui.Constants.DOWN_STATE?(c=this.upClass,d=this.downClass):(c=this.downClass,d=this.upClass),this.state=b,this.container.removeClass(c).addClass(d)}else alert(b+" is an improper state")},b.prototype.toggleState=function(){this.stateful&&this.setState(this.state==a.ui.Constants.DOWN_STATE?a.ui.Constants.UP_STATE:a.ui.Constants.DOWN_STATE)};var c=a.ui.Menu=function(a,c){var d=this;this.menuItems=[],this.shown=!1,this.enabled=!0,b.call(this),a&&this.setTitle(a),c||this.setAction(function(a){if(d.shown)d.hide(),jQuery(document).unbind("click.menu");else{var b=0;jQuery(".ui-dialog").each(function(){var a=parseInt(jQuery(this).css("zIndex"));b=a>b?a:b}),d.show(),d.list.css("zIndex",b+1),jQuery(document).bind("click.menu",function(a){var b=jQuery(a.target),c=b.parents(".uiMenu");c.size()==0&&d.hide()})}})};c.prototype=new b,c.prototype.constructor=c,c.prototype.layout=function(){this.container=jQuery('<div class="uiMenu"></div>'),this.titleLink=jQuery("<span></span>"),this.list=jQuery("<ul></ul>"),this.listItem=jQuery("<li></li>"),this.container.append(this.titleLink).append(this.list),this.list.hide()},c.prototype.addMenuItem=function(b){if(b instanceof a.ui.MenuItem){var c=this.listItem.clone(),d=this;c.append(b.getUI()),this.list.append(c),this.menuItems.push(b),b.addListener(a.events.MenuItemClicked,function(a){d.hide()})}else alert("Must be a menu item "+b.getUI.html())},c.prototype.setTitle=function(a){this.titleLink.text(a).attr("id","uiMenuItem_"+a)},c.prototype.setAction=function(a){var b=this;this.titleLink.bind("click",function(c){b.enabled&&a(c)})},c.prototype.setEnabled=function(a){this.enabled=a},c.prototype.hide=function(){this.list.fadeOut(200),this.shown=!1,this.titleLink.removeClass("uiMenuShown")},c.prototype.show=function(){this.list.fadeIn(200),this.shown=!0,this.titleLink.addClass("uiMenuShown")};var d=a.ui.PopupMenu=function(a){c.call(this,a,!0)},e=c.prototype;d.prototype=new c,d.prototype.constructor=d,d.prototype.finishLayout=function(){e.finishLayout.call(this),this.container.css({zIndex:a.ui.Layer.MENU}).hide(),this.list.show()},d.prototype.hide=function(){this.container.fadeOut(200),this.shown=!1,jQuery(document).unbind("click.menu"),this.parent.removeClass("uiMenuShown"),this.parent=null},d.prototype.show=function(a,b){jQuery(document).bind("click.menu",function(a){var d=jQuery(a.target),e=d.parents(".uiMenu");e.size()==0&&d[0]!=b[0]&&c.hide()}),this.container.css({top:a.top,left:a.left}).fadeIn(200),this.shown=!0;var c=this;this.parent=b,b.addClass("uiMenuShown")}}(editor),function(a){"use strict",a.ui=a.ui||{},a.ui.ColorPickerDefaults={container:null,inputId:"color",buttonId:"colorPicker",containerClass:""};var b=a.ui.ColorPicker=function(b){var c=jQuery.extend({},a.ui.ColorPickerDefaults,b);a.ui.Component.call(this,c)};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){this.container=jQuery("<div></div>"),this.container.addClass(this.config.containerClass),this.rInput=jQuery('<input type="text" class="rNdx color" placeholder="r" disabled />'),this.gInput=jQuery('<input type="text" class="gNdx color" placeholder="g" disabled />'),this.bInput=jQuery('<input type="text" class="bNdx color" placeholder="b" disabled />'),this.aInput=jQuery('<input type="text" class="aNdx color" placeholder="a" disabled />'),this.pickerBtn=jQuery('<span class="colorPicker"></span>'),this.container.append(this.rInput).append(this.gInput).append(this.bInput).append(this.aInput).append(this.pickerBtn),this.setupColorPicker()},b.prototype.setupColorPicker=function(){var b=this.rInput,c=this.gInput,d=this.bInput,e=this.aInput,f=this.pickerBtn,g=a.ui.Layer.DIALOG,h=this,i={window:{expandable:!0,alphaSupport:!0,position:{x:"left",y:"center"},effects:{type:"fade",speed:{show:"fast"}}},images:{clientPath:"js/lib/jpicker/images/"},color:{active:"#ffffff"}},j=function(f){var g=a.utils.roundNumber;b.val(g(f.val("r")/255,2)),c.val(g(f.val("g")/255,2)),d.val(g(f.val("b")/255,2)),e.val(g(f.val("a")/255,2));var h=[parseFloat(b.val()),parseFloat(c.val()),parseFloat(d.val()),parseFloat(e.val())];return h};f.data("container",this).jPicker(i,function(b,c){var d=j(b);h.notifyListeners(a.events.ColorPicked,d)});var k=!1,l=jQuery.jPicker.List;for(var m=0,n=l.length;m<n&&!k;m++){var o=l[m];jQuery(o).data("container")===this&&(this.picker=o,k=!0)}setTimeout(function(){jQuery("div.jPicker.Container:last.Move").text("Color Picker"),jQuery(h.picker).siblings(".jPicker").bind("click",function(a){var b=jQuery(this),c=i.window;jQuery("div.jPicker.Container").each(function(){var a=jQuery(this);if(parseInt(a.css("zIndex"))===10)a.css({zIndex:g});else{var d=c.position.x=="left"?b.offset().left-530-(c.position.y=="center"?25:0):c.position.x=="center"?b.offset().left-260:c.position.x=="right"?b.offset().left-10+(c.position.y=="center"?25:0):c.position.x=="screenCenter"?($(document).width()>>1)-260:b.offset().left+parseInt(c.position.x),e=c.position.y=="top"?b.offset().top-312:c.position.y=="center"?b.offset().top-156:c.position.y=="bottom"?b.offset().top+25:b.offset().top+parseInt(c.position.y);a.css({zIndex:g+1,left:Math.max(d,0)+"px",position:"absolute",top:Math.max(e,0)+"px"})}})}),jQuery("div.jPicker.Container:last").unbind("mousedown").bind("mousedown",function(){jQuery("div.jPicker.Container").each(function(){jQuery(this).css({zIndex:g})}),jQuery(this).css({zIndex:g+1})})},0)},b.prototype.setColor=function(a){this.rInput.val(a[0]),this.gInput.val(a[1]),this.bInput.val(a[2]),this.aInput.val(a[3]),this.picker.color.active.val("rgba",{r:a[0]*255,g:a[1]*255,b:a[2]*255,a:a[3]*255})},b.prototype.setColorHex=function(a,b){var c=jQuery.jPicker.ColorMethods,d=(typeof a=="number"?a.toString(16):a)+c.intToHex(b*255),e;while(d.length<8)d="0"+d;e=c.hexToRgba(d),this.rInput.val(e.r/255),this.gInput.val(e.g/255),this.bInput.val(e.b/255),this.aInput.val(b),this.picker.color.active.val("rgba",{r:e.r,g:e.g,b:e.b,a:e.a})},b.prototype.getColor=function(){var a=this.rInput.val(),b=this.gInput.val(),c=this.bInput.val(),d=this.aInput.val(),e=null;a!==""&&b!==""&&c!==""&&d!==""&&(a=parseFloat(a),b=parseFloat(b),c=parseFloat(c),d=parseFloat(d),isNaN(a)||isNaN(b)||isNaN(c)||isNaN(d)||(e=[a,b,c,d]));return e},b.prototype.getColorHex=function(){var a=jQuery.jPicker.ColorMethods,b=this.rInput.val(),c=this.gInput.val(),d=this.bInput.val(),e=this.aInput.val(),f=null;b!==""&&c!==""&&d!==""&&e!==""&&(b=parseFloat(b)*255,c=parseFloat(c)*255,d=parseFloat(d)*255,isNaN(b)||isNaN(c)||isNaN(d)||(f=parseInt(a.intToHex(b)+a.intToHex(c)+a.intToHex(d),16)));return f},b.prototype.getAlpha=function(){var a=this.aInput.val();if(a!=="")return parseFloat(a)},b.prototype.reset=function(){this.rInput.val(""),this.gInput.val(""),this.bInput.val(""),this.aInput.val(""),this.picker.color.active.val("hex","#ffffff")}}(editor),function(a){"use strict",a.ui=a.ui||{};var b=function(b){var c=jQuery.extend({cls:"",mouseHide:!0},b);a.ui.Component.call(this,c),this.id=0,this.currentElement=null};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){var a=this,b=function(){a.isAnimating||a.hide(0)};this.container=jQuery('<div class="tooltip '+this.config.cls+'"></div>'),this.msg=jQuery('<div class="content"></div>'),this.arrow=jQuery('<div class="arrow"></div>'),this.container.append(this.msg),this.config.mouseHide&&this.container.bind("mouseenter",b).bind("mouseleave",b),this.msg.css("borderLeftWidth")!==0?(this.arrow.addClass("outer"),this.innerArrow=jQuery('<div class="innerArrow"></div>'),this.msg.before(this.arrow),this.container.append(this.innerArrow)):this.container.append(this.arrow),this.container.hide(),this.isVisible=!1},b.prototype.show=function(a,b,c,d){var e=this.container,f=this,g=jQuery.extend({top:0,left:0},d);this.currentElement=a,this.container.parents().size()===0&&jQuery("body").append(this.container),jQuery.type(b)=="string"?this.msg.text(b):this.msg.empty().append(b),e.show();var h=a.offset(),i=e.outerHeight(!0),j=e.outerWidth(!0),k=a.width()/2,l=a.height(),m=h.top-i<0,n=this.arrow.outerHeight(),o=this.arrow.outerWidth()/2,p=o>k?5:k-o,q=window.innerWidth?window.innerWidth:document.documentElement.offsetWidth,r=jQuery(window).height(),s=j+h.left>q?h.left-(q-j):0,t=m?h.top+l+n+g.top:h.top-i-g.top,u=m?r-(h.top+l+n+g.top+i):r-(h.top-g.top);e.css({bottom:u-20,left:h.left-s}),m?(this.innerArrow.addClass("top"),this.arrow.addClass("top")):(this.innerArrow.removeClass("top"),this.arrow.removeClass("top")),this.innerArrow.css({left:p}),this.arrow.css({left:p});if(!this.isAnimating){var v=jQuery(document),w=function(a){if(f.currentElement){var b=f.currentElement[0],c=a.target,d=jQuery(c).parent()[0];c!==b&&d!==b&&f.hide(0)}v.unbind("mousemove",w)};this.isAnimating=!0,e.css("opacity",0).animate({opacity:1,bottom:"+=20"},200,function(){f.isAnimating=!1,f.isVisible=!0,v.bind("mousemove",w)})}c!=null&&this.hideTimer(!0,c)},b.prototype.hide=function(a){this.hideTimer(!1,a)},b.prototype.hideTimer=function(a,b){var c=this,d=this.id,e=b==null?2e3:b;a&&(d=this.id+=1),setTimeout(function(){c.hideMessage(d)},e)},b.prototype.hideMessage=function(a){if(this.id===a){var b=this.container,c=this;b.animate({opacity:0,bottom:"+=20"},200,function(){b.hide(),c.isVisible=!1,c.currentElement=null})}},a.ui.createTooltip=function(a){return new b(a)}}(editor),function(a){function f(a,b,c){var d=parseFloat(a);return a===""||(b!=null&&c!=null?d>=b&&d<=c:b!=null&&c==null?d>=b:d<=c)}function e(a){return a===""||hemi.utils.isNumeric(a)}"use strict",a.ui=a.ui||{};var b=new a.ui.createTooltip({cls:"errorWrapper"}),c=a.ui.Validator=function(b,c){a.utils.Listenable.call(this),this.checkFunction=c,this.containerClass="errorWrapper",b!=null&&this.setElements(b)};c.prototype=new a.utils.Listenable,c.prototype.constructor=c,c.prototype.setElements=function(a){var c=this;a.bind("change.errEvt",function(a){var d=jQuery(this),e=null;e=c.checkFunction(d),e?(b.show(d,e,2e3),d.addClass("error")):(b.hide(),d.removeClass("error"))})};var d=a.ui.VectorValidator=function(c){a.utils.Listenable.call(this),this.containerClass="errorWrapper",this.timeoutId=null,this.vector=c;var d=c.find("."+c.config.type),e=this;d.bind("focus",function(a){e.timeoutId&&(clearTimeout(e.timeoutId),e.timeoutId=null)}).bind("blur",function(a){var c=e.vector.inputs,f=c[0].elem.getValue(),g=f===""||f===null,h=null;for(var i=1,j=c.length;i<j&&!h;i++){var k=c[i].elem.getValue(),l=k===""||k===null;l!==g&&(h="must fill out all values")}h?e.timeoutId=setTimeout(function(){e.timeoutId=null,b.show(e.vector.getUI(),h,3e3),d.addClass("error")},1500):(b.hide(),d.removeClass("error"))})};d.prototype=new a.utils.Listenable,d.prototype.constructor=d,a.ui.createDefaultValidator=function(b,c){var d=new a.ui.Validator(null,function(a){var b=a.val(),c=null;e(b)?(this.min!=null||this.max!=null)&&!f(b,this.min,this.max)&&(c=this.min!=null&&this.max!=null?"must be between "+this.min+" and "+this.max:this.min!=null?"must be greater than or equal to "+this.min:"must be less than or equal to "+this.max):c="must be a number";return c});d.min=b,d.max=c;return d};return a}(editor||{},jQuery),function(a){function m(a,b){var c=jQuery.inArray(a,b)!==-1;if(!c)for(var d=0,e=b.length;d<e&&!c;d++){var f=b[d];if(jQuery.isArray(f))c=jQuery.inArray(a,f)!==-1;else break}return c}function k(a){this.container.find(".vectorVec").remove(),this.inputs=[];for(var b=0,e=a.length;b<e;b++){var f=this.inputs[b],g=a[b],h=jQuery.isArray(g);if(f==null)if(h){var i=c.call(this,b);f=this.inputs[b]=i.inputs,this.addBtn.before(i.div),f.div=i.div}else f=this.inputs[b]=d.call(this),this.addBtn.before(f.container);if(h)for(var j=0,k=g.length;j<k;j++){var l=g[j],m=f[j];m==null&&(m=f[j]=d.call(this)),m.setValue(l),f.div.find("button").before(m.container)}else f.setValue(a[b])}}function j(a){var b=this.inputs;if(jQuery.isArray(a)){var c=function(a,c){var d=null;for(var e=0,f=b.length;e<f&&d==null;e++){var g=b[e],h=g.ndx2!=null;if(h&&g.ndx1===a&&g.ndx2===c||!h&&g.ndx1===a)d=g}return d};for(var d=0,e=a.length;d<e;d++){var f=a[d];if(this.multiDim)for(var g=0,h=f.length;g<h;g++){var i=f[g];c(d,g).elem.setValue(i)}else c(d).elem.setValue(f)}}else for(var j in a){var k=-1;for(var d=0,e=b.length;d<e&&k===-1;d++)b[d].key==j&&(k=d);var l=b[k].elem;l&&(l.setValue(a[j]),l.container.removeClass("vectorHelper"))}}function i(){var a=this,b=a.find("."+this.config.type);b.bind("keydown",function(a){var b=jQuery(this);b.removeClass("vectorHelper")}).bind("blur",function(b){a.config.onBlur&&a.config.onBlur(jQuery(this),b,a)})}function h(){var a=this,b=0;this.addBtn=jQuery("<button>Add</button>");do{if(this.multiDim){var e=c.call(this,b);this.inputs.push(e.inputs),this.container.append(e.div)}else{var f=d.call(this);this.inputs.push(f),this.container.append(f.container)}b++}while(b<this.config.inputs.length);this.addBtn.bind("click",function(){var b=jQuery(this),e=b.data("ndx");if(a.multiDim){var f=c.call(a,e);a.inputs.push(f.inputs),b.before(f.div)}else{var g=d.call(this);this.inputs.push(g),b.before(g.container)}b.data("ndx",e+1)}).data("ndx",b),this.container.append(this.addBtn)}function g(){var a=this.config.inputs,b=a.length,c=!1;b===1&&hemi.utils.isNumeric(a[0])&&(b=a[0],c=!0);for(var e=0;e<b;e++){var f=a[e];if(this.multiDim){var g=jQuery('<div class="vectorVec"></div>');f.length===1&&hemi.utils.isNumeric(f[0])&&(jl=f[0],c=!0);for(var h=0;h<jl;h++){var j=f[h],k=d.call(this,c?null:j);this.inputs.push({ndx1:e,ndx2:h,key:j,elem:k}),g.append(k.container)}this.container.append(g)}else{var k=d.call(this,c?null:f);this.inputs.push({ndx1:e,key:f,elem:k}),this.container.append(k.container)}}i.call(this)}function f(){var a=[],b=!0,c=function(a){var b=obj.elem.getValue();b===""&&(b=null);return b};for(var d=0,e=this.inputs.length;d<e&&b;d++){var f=this.inputs[d];if(jQuery.isArray(f)){var g=[];for(var h=0,i=f.length;h<i&&b;h++){var j=c(f[h]);g.push(j),b=j!=null}a.push(g)}else{var j=c(f);a.push(j),b=j!=null}}return b?a:null}function e(){var a=[],b=!0;for(var c=0,d=this.inputs.length;c<d&&b;c++){var e=this.inputs[c],f=e.elem.getValue();b=f!==""&&f!==null;if(b)if(this.multiDim){var g=a[e.ndx1];g==null&&(g=a[e.ndx1]=[]),g[e.ndx2]=f}else a[e.ndx1]=f}return b?a:null}function d(b){var c=this.config;return new a.ui.Input({inputClass:c.type,onBlur:c.onBlur,placeHolder:b,type:c.inputType,validator:c.validator})}function c(a){var b=jQuery('<div class="vectorVec"></div>'),c=jQuery("<button>Add</button>"),e=d.call(this),f=this;c.bind("click",function(){var a=jQuery(this),b=a.data("ndx"),c=d.call(f);f.inputs[b].push(c),a.before(c.container)}).data("ndx",a),b.append(e.container).append(c);return{div:b,inputs:[e]}}"use strict",a.ui=a.ui||{},a.ui.VectorDefaults={container:null,inputs:["x","y","z"],type:"vector",inputType:"number",onBlur:null,validator:null};var b=a.ui.Vector=function(b){var c=jQuery.extend({},a.ui.VectorDefaults,b),d=c.inputs;this.unbounded=d.length===0,this.multiDim=jQuery.isArray(d[0]),this.multiDimUnbounded=this.multiDim&&d[0].length===0,this.inputs=[],a.ui.Component.call(this,c)};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){this.container=this.config.container||jQuery("<div></div>"),this.unbounded||this.multiDimUnbounded?h.call(this):g.call(this),this.validator=new a.ui.VectorValidator(this)},b.prototype.setValue=function(a){this.unbounded||this.multiDimUnbounded?k.call(this,a):j.call(this,a)},b.prototype.getValue=function(){return this.unbounded||this.multiDimUnbounded?f.call(this):e.call(this)},b.prototype.reset=function(){for(var a=0,b=this.inputs.length;a<b;++a)this.inputs[a].elem.reset()},b.prototype.setInputName=function(a,b,c){var d=!1;for(var e=0,f=this.inputs.length;e<f&&!d;++e){var g=this.inputs[e];g.ndx1===b&&g.ndx2==c&&(g.elem.setName(a),d=!0)}return d},b.prototype.setInputType=function(a){for(var b=0,c=this.inputs.length;b<c;++b)this.inputs[b].elem.setType(a)};var l=a.ui.Vector3=function(a){b.call(this,a)};l.prototype=new b,l.prototype.constructor=l,l.prototype.setValue=function(a){var c;a?c=[a.x,a.y,a.z]:c=[null,null,null],b.prototype.setValue.call(this,c)},l.prototype.getValue=function(){var a=b.prototype.getValue.call(this),c=a?new THREE.Vector3(a[0],a[1],a[2]):null;return c}}(editor||{}),function(a){"use strict",a.ui=a.ui||{};var b=0;a.ui.TreeSelectorDefaults={containerClass:"",panelHeight:400,tree:null,select:null};var c=a.ui.TreeSelector=function(c){var d=jQuery.extend({},a.ui.TreeSelectorDefaults,c);this.eventName="click.treeSelector"+b,this.buttonId="treeSelectorBtn"+b,this.inputId="treeSelectorIpt"+b,this.panelId="treeSelectorPnl"+b++,a.ui.Component.call(this,d)};c.prototype=new a.ui.Component,c.prototype.constructor=c,c.prototype.layout=function(){var a=this,b=function(b){var c=a.input,d=a.picker,e=a.panel;if(e.is(":visible"))a.hidePanel(),jQuery(document).unbind(a.eventName),e.data("docBound",!1),d.removeClass("open"),c.removeClass("open");else{var f=e.data("docBound"),g=0;c.addClass("open"),d.addClass("open"),g=c.outerWidth()+d.outerWidth()-a.treeBorder-a.treePadding,a.showPanel(g),f||(jQuery(document).bind(a.eventName,function(b){var c=jQuery(b.target),d=c.parents("#"+a.panelId),e=c.attr("id");d.size()==0&&e!=a.panelId&&e!=a.inputId&&e!=a.buttonId&&a.hidePanel()}),e.data("docBound",!0))}};this.container=jQuery('<div class="treeSelector"></div>'),this.input=jQuery('<input type="text" id="'+this.inputId+'" class="treeSelectorIpt" readonly="readonly" placeholder="Select an item" />'),this.picker=jQuery('<button id="'+this.buttonId+'" class="treeSelectorBtn">Selector</button>');var c=this.panel=jQuery('<div id="'+this.panelId+'" class="treeSelectorPnl"></div>');this.treeBorder=Math.ceil(parseFloat(c.css("borderRightWidth")))+Math.ceil(parseFloat(c.css("borderLeftWidth"))),this.treePadding=Math.ceil(parseFloat(c.css("paddingLeft")))+Math.ceil(parseFloat(c.css("paddingRight"))),this.selFcn=function(b,c){if(a.config.select)a.config.select(c,a)&&(a.picker.removeClass("selected"),a.hidePanel());else{var d=c.rslt.obj,e=d.find("a").text();a.input.val(e),a.hidePanel(),a.picker.removeClass("selected"),a.setSelection(e)}},this.config.tree?this.setTree(this.config.tree):this.input.attr("placeholder","No items to select"),this.container.addClass(this.config.containerClass),jQuery("body").append(this.panel),this.container.append(this.input).append(this.picker),this.panel.css({maxHeight:this.config.panelHeight,position:"absolute"}).hide(),this.input.bind("click",b),this.picker.bind("click",b)},c.prototype.getSelection=function(){return this.input.data("selectObj")},c.prototype.hidePanel=function(){this.panel.slideUp(200),this.input.removeClass("open"),this.picker.removeClass("open")},c.prototype.reset=function(){this.input.val(""),this.input.removeData("selectObj"),this.tree.jstree("deselect_all")},c.prototype.select=function(a){var b=jQuery("#"+a);this.tree.jstree("select_node",b)},c.prototype.setSelection=function(a){this.input.data("selectObj",a)},c.prototype.setTree=function(a){this.tree=a,a.bind("select_node.jstree",this.selFcn).addClass("treeSelectorTree"),this.panel.append(a)},c.prototype.showPanel=function(a){var b=this.input.offset(),a=a||this.container.width();b.top+=this.input.outerHeight(),this.panel.css({top:b.top,left:b.left}).width(a).slideDown(200)}}(editor),function(a){"use strict",a.ui=a.ui||{},a.ui.ListType={UNORDERED:0,ORDERED:1},a.ui.ListDefaults={id:"",cssClass:"",prefix:"lst",type:a.ui.ListType.UNORDERED,sortable:!1};var b=a.ui.List=function(b){var c=jQuery.extend({},a.ui.ListDefaults,b);a.ui.Component.call(this,c),this.list,this.listItemTemplate,this.idCounter=0,this.listItems=new Hashtable};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.add=function(a){this.list.append(this.createListItem(a)),a.setParent(this)},b.prototype.after=function(a,b){b.getUI().parent().after(this.createListItem(a)),a.setParent(this)},b.prototype.before=function(a,b){b.getUI().parent().before(this.createListItem(a)),a.setParent(this)},b.prototype.clear=function(){this.list.empty(),this.listItems.clear()},b.prototype.createListItem=function(a){var b=jQuery("<li></li>"),c=this.config.prefix+"LstItm-"+this.idCounter;b.attr("id",c).append(a.getUI()),b.data("obj",a),this.listItems.put(a,b),this.idCounter+=1;return b},b.prototype.edit=function(a,b,c){var d=this.list.find("#"+a),e=d.data("obj");e.attachObject(b),e.setText(c)},b.prototype.layout=function(){this.container=this.list=this.config.type==a.ui.ListType.UNORDERED?jQuery('<ul class="listWidget"></ul>'):jQuery('<ol class="listWidget"></ol>'),this.list.attr("id",this.config.id).addClass(this.config.cssClass),this.config.sortable&&this.list.sortable()},b.prototype.makeSortable=function(){this.list.sortable()},b.prototype.remove=function(b){var c=null;if(typeof b=="string"){c=this.list.find("#"+b);var d=c.data("obj");d.setParent(null),this.listItems.remove(d)}else b instanceof a.ui.ListItem&&(c=this.listItems.remove(b));c!==null&&c.remove()};var c=a.ui.ListItem=function(b){a.ui.Component.call(this,b)};c.prototype=new a.ui.Component,c.prototype.constructor=c,c.prototype.attachObject=function(a){this.container.data("obj",a)},c.prototype.data=function(a,b){return b!=null?this.container.data(a,b):this.container.data(a)},c.prototype.layout=function(){this.container=jQuery("<div></div>")},c.prototype.getAttachedObject=function(){return this.container.data("obj")},c.prototype.getId=function(){return this.container.parent().attr("id")},c.prototype.getText=function(){return this.container.text()},c.prototype.remove=function(){this.container.remove()},c.prototype.removeObject=function(){this.container.data("obj",null)},c.prototype.setId=function(a){this.container.parent().attr("id",a)},c.prototype.setParent=function(a){this.parent=a},c.prototype.setText=function(a){this.container.text(a)},a.ui.EdtLiWgtDefaultOptions={removable:!0,editable:!0};var d=a.ui.EditableListItem=function(b){var c=jQuery.extend({},a.ui.EdtLiWgtDefaultOptions,b);a.ui.ListItem.call(this,c)},e=a.ui.ListItem.prototype;d.prototype=new a.ui.ListItem,d.prototype.constructor=d,d.prototype.layout=function(){e.layout.call(this);var a=jQuery('<div class="buttonContainer"></div>');this.title=jQuery("<span></span>"),this.config.editable&&(this.editBtn=jQuery('<button class="editBtn">Edit</button>'),a.append(this.editBtn)),this.config.removable&&(this.removeBtn=jQuery('<button class="removeBtn">Remove</button>'),a.append(this.removeBtn)),this.container.append(this.title).append(a)},d.prototype.getText=function(){return this.title.text()},d.prototype.setText=function(a){this.title.text(a)}}(editor),function(){function k(a){var b=jQuery(this).find("button.minMax"),c={};g(!0,b.data("origOpacity"),b,c),b.animate(c)}function j(a){var b=jQuery(this).find("button.minMax"),c={};g(!1,b.data("origOpacity"),b,c),b.animate(c,function(){b.hide()})}function i(a,b,c){var d=a.container,e=a.minMaxBtn,f={},i=b?0:-20,l;switch(a.config.location){case editor.ui.Location.TOP:l="top";break;case editor.ui.Location.BOTTOM:l="bottom";break;case editor.ui.Location.RIGHT:l="right";break;default:l="left"}if(b)e.data("min")||d.bind("mouseenter",k).bind("mouseleave",j),e.data("min",!0).text("Min").hide();else{var m=parseInt(d.css(l),10);c=c||m<i}c?b?(d.css(l,i).css("opacity",a.origOpacity).show(),e.css(l,i)):(d.css(l,i).css("opacity",0).hide(),e.css(l,i)):(g(b,a.origOpacity,d,f,d),h(a,i,f),d.animate(f,function(){b||d.hide()}))}function h(a,b,c){var d=a.container,e;switch(a.config.location){case editor.ui.Location.TOP:e="top";break;case editor.ui.Location.BOTTOM:e="bottom";break;case editor.ui.Location.RIGHT:e="right";break;default:e="left"}var f=parseInt(d.css(e),10),g="+="+(b-f);c[e]=g}function g(a,b,c,d){var e=a?0:b,f=a?b:0;d.opacity=f,c.css("opacity",e),a&&c.show()}"use strict",editor.ui=editor.ui||{},editor.ui.Layer={TOOL:500,TOOLBAR:600,DIALOG:700,MENU:800},editor.ui.Location={TOP:0,RIGHT:1,BOTTOM:2},editor.ui.Height={FULL:0,HALF:1,THIRD:2,MANUAL:3};var a=50,b=1,c=1e4,d=.5,e=[],f=function(a){var b=jQuery.extend({location:editor.ui.Location.RIGHT,classes:[],minMax:!0,startsVisible:!0},a);this.minMaxBtn=null,this.origOpacity=null,this.visible=!0,this.name=b.location===editor.ui.Location.TOP?"topPanel":b.location===editor.ui.Location.BOTTOM?"bottomPanel":"sidePanel",editor.ui.Component.call(this,b),a.extending||e.push(this)};f.prototype=new editor.ui.Component,f.prototype.constructor=f,f.prototype.layout=function(){var a=this.minMaxBtn=jQuery('<button class="minMax" style="position:absolute;"></button>'),b=this.container=jQuery("<div></div>"),c=this;jQuery("body").append(b),this.config.minMax&&b.append(a),b.css({zIndex:editor.ui.Layer.TOOL}).bind("mouseenter",k).bind("mouseleave",j),a.bind("click",function(b){var d=a.data("min");d?c.minimize():c.maximize(),a.data("min",!d)}).data("origOpacity",1).data("min",!0).text("Min").hide();for(var d=0,e=this.config.classes.length;d<e;d++)b.addClass(this.config.classes[d]);switch(this.config.location){case editor.ui.Location.RIGHT:b.addClass("rightAligned");break;case editor.ui.Location.TOP:b.addClass("topAligned");break;case editor.ui.Location.BOTTOM:b.addClass("bottomAligned")}this.origOpacity=b.css("opacity")},f.prototype.getName=function(){return this.name},f.prototype.getPreferredHeight=function(){return this.preferredHeight},f.prototype.isVisible=function(){return this.visible},f.prototype.maximize=function(){var a={},b=this.minMaxBtn,c=this;h(this,0,a),this.container.bind("mouseleave",j).bind("mouseenter",k).animate(a,function(){b.text("Min")}).removeClass("minimized")},f.prototype.minimize=function(){var a={},b=this.minMaxBtn,c=this,d;switch(this.config.location){case editor.ui.Location.TOP:case editor.ui.Location.BOTTOM:d=this.container.height();break;case editor.ui.Location.RIGHT:default:d=this.container.width()}h(this,-1*d,a),this.container.unbind("mouseleave",j).unbind("mouseenter",k).animate(a,function(){b.text("Max")}).addClass("minimized")},f.prototype.resize=function(){var a=this.container.outerHeight(),b=this.container.outerWidth(),c=this.minMaxBtn.outerHeight(),d=this.minMaxBtn.outerWidth(),e=window.innerWidth?window.innerWidth:document.documentElement.offsetWidth,f=(e-b)/2;switch(this.config.location){case editor.ui.Location.RIGHT:this.minMaxBtn.css({top:(a-c)/2,right:b});break;case editor.ui.Location.TOP:this.container.css({left:f}),this.minMaxBtn.css({left:(b-d)/2,top:a});break;case editor.ui.Location.BOTTOM:this.container.css({left:f}),this.minMaxBtn.css({left:(b-d)/2,bottom:a});break;default:this.minMaxBtn.css({top:(a-c)/2,left:b})}},f.prototype.setVisible=function(a,b){if(a!==this.visible){i(this,a,b),a||this.container.bind("mouseleave",j).bind("mouseenter",k).removeClass("minimized");var c=this;this.resize(),this.visible=a,this.notifyListeners(editor.events.PanelVisible,{panel:c,visible:a})}};var l=function(){this.panes=new Hashtable,this.visiblePane=null,f.call(this,{location:3})},m=f.prototype;l.prototype=new f({extending:!0}),l.prototype.constructor=l,l.prototype.layout=function(){m.layout.call(this);var a=jQuery('<h1><span>World</span><span class="editor">Editor</span></h1>');this.list=jQuery("<ul></ul>"),this.container.attr("id","navBar").append(a).append(this.list),this.resize()},l.prototype.add=function(a,b){var c=jQuery("<li></li>"),d=a.getUI(),e=this;b!=null&&c.attr("id",b),c.append(d),d.find("a").bind("click",function(b){e.visiblePane&&e.visiblePane!==a&&e.visiblePane.setVisible(!1),a.setVisible(!a.isVisible()),a.isVisible()?e.visiblePane=a:e.visiblePane=null}),this.list.append(c),this.panes.put(a.title,{li:c,pane:a}),a.addListener(editor.events.Enabled,function(a){var b=e.panes.get(a.item);a.enabled?b.li.show():b.pane.setVisible(!1,function(){b.li.hide()})})},l.prototype.get=function(a){var b=this.panes.get(a);return b!=null?b.pane:b};var n=editor.ui.NavPane=function(a,b){this.toolbar=null,this.title=a,this.visible=!1,editor.ui.Component.call(this,b)};n.prototype=new editor.ui.Component,n.prototype.constructor=editor.ui.NavPane,n.prototype.layout=function(){this.toolbarContainer=jQuery('<div class="toolbarContainer"></div>'),this.toolbarContainer.hide(),this.container=jQuery("<div></div>"),this.titleElem=jQuery('<h2><a href="#">'+this.title+"</a></h2>"),this.container.append(this.titleElem).append(this.toolbarContainer)},n.prototype.add=function(a){this.toolbar.add(a)},n.prototype.isVisible=function(){return this.visible},n.prototype.notify=function(a,b){a===editor.events.Enabled&&this.setEnabled(b.enabled)},n.prototype.remove=function(a){this.toolbar.remove(a)},n.prototype.setEnabled=function(a){this.notifyListeners(editor.events.Enabled,{item:this.title,enabled:a})},n.prototype.setToolBar=function(a){this.toolbar=a;var b=a.getUI();this.toolbarContainer.append(b),this.toolbar.addListener(editor.events.Enabled,this)},n.prototype.setVisible=function(a,b){a?(this.toolbarContainer.slideDown(function(){b&&b()}),this.toolbar.loadState(),this.container.addClass("down"),this.visible=!0):(this.toolbarContainer.slideUp(function(){b&&b()}),this.toolbar.saveState(),this.container.removeClass("down"),this.visible=!1)};var o=editor.ui.Panel=function(a){this.widgets=[],a=a||{},a.classes?a.classes.unshift("panel"):a.classes=["panel"],f.call(this,a)},p=f.prototype;o.prototype=new f({extending:!0}),o.prototype.constructor=o,o.prototype.finishLayout=function(){p.finishLayout.call(this),this.setVisible(!1,!0)},o.prototype.addWidget=function(a){var b=this;this.container.append(a.getUI()),this[a.getName()]=a,this.widgets.push(a),a.setMinHeight(parseInt(this.container.css("min-height"),10)),a.addListener(editor.events.Invalidate,function(a){b.resize()})},o.prototype.resize=function(){p.resize.call(this);for(var a=0,b=this.widgets.length;a<b;a++)this.widgets[a].sizeAndPosition()},o.prototype.setVisible=function(a,b){if(a!==this.visible){p.setVisible.call(this,a,b);for(var c=0,d=this.widgets.length;c<d;c++)this.widgets[c].sizeAndPosition()}};var q=editor.ui.FullPanel=function(a){a=a||{},a.minMax=!1,a.classes?a.classes.unshift("fullPanel"):a.classes=["fullPanel"],o.call(this,a)};q.prototype=new o({extending:!0}),q.prototype.constructor=q,editor.ui.WidgetDefaults={classes:[],height:editor.ui.Height.HALF,name:"defaultName"};var r=editor.ui.Widget=function(a){var b=jQuery.extend({},editor.ui.WidgetDefaults,a);b.classes?b.classes.unshift("widget"):b.classes=["widget"],this.minHeight=null,editor.ui.Component.call(this,b)},s=editor.ui.Component.prototype;r.prototype=new editor.ui.Component,r.prototype.constructor=r,r.prototype.layout=function(){this.container||(this.container=jQuery("<div></div>"))},r.prototype.finishLayout=function(){for(var a=0,b=this.config.classes.length;a<b;a++)this.container.addClass(this.config.classes[a]);this.find("form").addClass("widgetForm").submit(function(){return!1}),this.sizeAndPosition()},r.prototype.getName=function(){return this.config.name},r.prototype.getPreferredHeight=function(){return this.preferredHeight},r.prototype.invalidate=function(){this.notifyListeners(editor.events.Invalidate,null)},r.prototype.setMinHeight=function(a){this.minHeight=a},r.prototype.setVisible=function(a){s.setVisible.call(this,a);var b=this;this.notifyListeners(editor.events.WidgetVisible,{widget:b,visible:a})},r.prototype.sizeAndPosition=function(){var a=this.container,b=parseInt(a.css("paddingBottom"),10)+parseInt(a.css("paddingTop"),10),c=jQuery(window),d=this.minHeight?Math.max(c.height(),this.minHeight):c.height();switch(this.config.height){case editor.ui.Height.FULL:a.height(d-b);break;case editor.ui.Height.HALF:a.height(d/2-b);break;case editor.ui.Height.THIRD:a.height(d/3-b);break;case editor.ui.Height.MANUAL:}a[0].scrollHeight>a.height()+b?a.addClass("hasScrollBar"):a.removeClass("hasScrollBar")};var t=editor.ui.FormWidget=function(a){this.checkers=[],a=a||{},a.classes?a.classes.unshift("widgetWithForms"):a.classes=["widgetWithForms"],r.call(this,a)};t.prototype=new r,t.prototype.constructor=t,t.prototype.addInputsToCheck=function(a){var b=this,c;a instanceof editor.ui.ColorPicker?(c={input:a,saveable:function(){return this.input.getColor()!=null}},this.checkers.push(c)):a instanceof editor.ui.Input||a instanceof editor.ui.Vector?(c={input:a,saveable:function(){return this.input.getValue()!=null}},this.checkers.push(c)):a instanceof editor.ui.InputChecker?this.checkers.push(a):a.each&&a.each(function(a,c){var d=jQuery(c),e={input:d,saveable:function(){return this.input.val()!==""}};b.checkers.push(e)})},t.prototype.checkSaveable=function(){var a=this.checkers,b=!0;for(var c=0,d=a.length;c<d&&b;c++)b=a[c].saveable();return b},editor.ui.InputChecker=function(a){this.input=a},editor.ui.InputChecker.prototype={saveable:function(){}},editor.ui.ListWidgetDefaults={name:"listSBWidget",listId:"list",prefix:"lst",title:"",instructions:"",type:editor.ui.ListType.UNORDERED,sortable:!1};var u=editor.ui.ListWidget=function(a){var b=jQuery.extend({},editor.ui.ListWidgetDefaults,a);editor.ui.Widget.call(this,b),this.items=new Hashtable},v=r.prototype;u.prototype=new r,u.prototype.constructor=u,u.prototype.add=function(a){var b=this.items.get(a._getId());b||(b=this.createListItem(),b.setText(a.name),b.attachObject(a),this.bindButtons(b,a),this.list.add(b),this.items.put(a._getId(),b));return b},u.prototype.bindButtons=function(a,b){var c=this;a.editBtn.bind("click",function(b){var d=a.getAttachedObject();c.notifyListeners(editor.events.Edit,d)}),a.removeBtn.bind("click",function(b){var d=a.getAttachedObject();editor.depends.check(d)&&c.notifyListeners(editor.events.Remove,d)})},u.prototype.clear=function(){this.list.clear(),this.items.clear()},u.prototype.createListItem=function(){return new editor.ui.EditableListItem},u.prototype.layout=function(){v.layout.call(this),this.title=jQuery("<h1>"+this.config.title+"</h1>"),this.instructions=jQuery("<p>"+this.config.instructions+"</p>"),this.list=new editor.ui.List({id:this.config.listId,prefix:this.config.prefix,type:this.config.type,sortable:this.config.sortable}),this.container.append(this.title).append(this.instructions).append(this.list.getUI())},u.prototype.remove=function(a){var b=this.items.get(a._getId()),c=!1;b&&(b.removeObject(),this.list.remove(b),this.items.remove(a._getId()),c=!0);return c},u.prototype.update=function(a){var b=this.items.get(a._getId()),c=!1;b&&(b.setText(a.name),b.attachObject(a),c=!0);return c};var w=null;editor.ui.addNavPane=function(a,b){w.add(a,b)},editor.ui.getNavBar=function(){return w},editor.ui.getNavPane=function(a){var b=w.get(a);b||(b=new editor.ui.NavPane(a),b.setToolBar(new editor.ui.ToolBar),w.add(b));return b},editor.ui.initializeView=function(e){var f=jQuery("body");e.setBGColor(16777215,1),editor.grid=new editor.ui.GridPlane(e,a,b),w=new l;var g=e.camera;g.enableControl(),g.far=c,g.near=d,g.name="Main Camera";var h=hemi.createViewData(e.camera);h.eye=new THREE.Vector3(0,10,40),h.target=new THREE.Vector3(0,0,0),g.moveToView(h,0),editor.ui.resizeView(),f.append('<div class="topBottomSelect"></div>')},editor.ui.resizeView=function(){var a=jQuery("body"),b=jQuery(window),c=jQuery(".mainView"),d=b.width(),f=b.height();d<=1024?(a.addClass("ten24"),d=1024):a.removeClass("ten24"),f<=728&&(f=728,a.hasClass("ten24")||a.addClass("ten24")),c.width(d),c.height(f);for(var g=0,h=e.length;g<h;g++)e[g].resize();editor.client._resize(),hemi.hudManager.resetTextBaseline()}}(),function(a){"use strict",a.ui=a.ui||{};var b=function(){a.ui.Component.call(this),this.progress=-1};b.prototype=new a.ui.Component,b.prototype.constructor=b,b.prototype.layout=function(){this.container=jQuery('<div id="progressIndicator"></div>'),this.text=jQuery('<span class="prgBarText">Loading...</span>'),this.barWrapper=jQuery('<div class="prgBarContainer"></div>'),this.indicator=jQuery('<div class="prgBarIndicator"></div>'),this.barWrapper.append(this.indicator),this.container.append(this.text).append(this.barWrapper),this.container.css("zIndex",a.ui.Layer.DIALOG),this.update(0),hemi.subscribe(hemi.msg.progress,this,"msgUpdate")},b.prototype.msgUpdate=function(a){var b=a.data,c=this.progress;b.isTotal&&(c=b.percent,this.update(c))},b.prototype.setVisible=function(a){var b=this.container;if(a){var c=jQuery(window).height(),d=window.innerWidth?window.innerWidth:document.documentElement.offsetWidth,e=c-b.height(),f=(d-b.width())/2;b.show().css({top:e+20+"px",left:f+"px",opacity:0,position:"absolute"}).animate({opacity:1,top:"-=20"},300)}else b.animate({opacity:0,top:"+=20"},400,function(){b.hide()})},b.prototype.update=function(a){if(this.progress!==a){this.isVisible()||this.setVisible(!0);var b=this;this.progress=a,this.indicator.width(this.barWrapper.width()*a/100),this.progress>=99.9&&setTimeout(function(){b.progress=-1,b.setVisible(!1)},100)}},a.ui.progressUI=new b,jQuery(document).bind("ready",function(){jQuery("body").append(a.ui.progressUI.getUI()),a.ui.progressUI.container.hide()})}(editor),function(a){function i(a,b){var c=hemi.utils.pointAsWorld(b,a.min),e=hemi.utils.pointAsWorld(b,a.max),f=Math.abs(c.x-e.x),g=Math.abs(c.y-e.y),h=Math.abs(c.z-e.z),i=(f+g+h)/3;return i<d?d:i}function h(a){var b=(a.min.x+a.max.x)/2,c=(a.min.y+a.max.y)/2,d=(a.min.z+a.max.z)/2;return new THREE.Vector3(b,c,d)}function g(a){var b=a.children,c=a instanceof hemi.Mesh?a.getBoundingBox():null;for(var d=0,e=b.length;d<e;d++){var f=g(b[d]);c&&f?(c.min=new THREE.Vector3(Math.min(f.min.x,c.min.x),Math.min(f.min.y,c.min.y),Math.min(f.min.z,c.min.z)),c.max=new THREE.Vector3(Math.max(f.max.x,c.max.x),Math.max(f.max.y,c.max.y),Math.max(f.max.z,c.max.z))):c=f}return c}"use strict",a.ui=a.ui||{},a.ui.trans=a.ui.trans||{};var b=5,c=10,d=4,e=new THREE.Vector3(1,1,1),f=new hemi.Mesh;hemi.world.removeCitizen(f),a.ui.trans.DrawState={TRANSLATE:0,ROTATE:1,SCALE:2,NONE:3};var j=a.ui.TransHandles=function(){a.utils.Listenable.call(this),this.canvas=hemi.hudManager.currentContext,this.drawCallback=null,this.transform=null,this.xArrow=new k(this.canvas,"#f00","#f99"),this.yArrow=new k(this.canvas,"#0c0","#9c9"),this.zArrow=new k(this.canvas,"#00f","#99f"),this.drawState=a.ui.trans.DrawState.NONE,hemi.addRenderListener(this),this.overrideHandlers()};j.prototype=new a.utils.Listenable,j.prototype.constructor=j,j.prototype.cleanup=function(){this.setDrawState(a.ui.trans.DrawState.NONE),this.setTransform(null),hemi.view.removeRenderListener(this);var b=hemi.input.mouseDown,c=hemi.input.mouseUp,d=hemi.input.mouseMove,e=this,f=this.canvas;f.removeEventListener("mousedown",this.mouseDownHandler,!0),f.removeEventListener("mousemove",this.mouseMoveHandler,!0),f.removeEventListener("mouseup",this.mouseUpHandler,!0),f.addEventListener("mousedown",b,!0),f.addEventListener("mousemove",c,!0),f.addEventListener("mouseup",d,!0),jQuery(document).unbind("mouseup.transhandles")},j.prototype.drawHandles=function(){if(this.drawState!==a.ui.trans.DrawState.NONE){var b=g(this.transform),c=h(b),d=i(b,this.transform)/2,e=c.x,f=c.y,j=c.z,k=new THREE.Vector3(e+d,f,j),l=new THREE.Vector3(e,f+d,j),m=new THREE.Vector3(e,f,j+d);this.xArrow.setParams(c,k,hemi.Plane.XY,this.drawState,d),this.yArrow.setParams(c,l,hemi.Plane.YZ,this.drawState,d),this.zArrow.setParams(c,m,hemi.Plane.XZ,this.drawState,d)}},j.prototype.convertEvent=function(a){var b=jQuery(a.target?a.target:a.srcElement),c=b.offset();a.x=a.pageX-c.left,a.y=a.pageY-c.top;return a},j.prototype.isInView=function(){var b=[[],[],[],[]],c=this.transform,d=this.transform.geometry.boundingBox,e=new THREE.Matrix4,f=new THREE.Frustum,g=a.client.camera;e.multiply(g.projectionMatrix,g.matrixWorldInverse),f.setFromMatrix(e);return f.contains(c)},j.prototype.onChange=function(b){var c=this;this.notifyListeners(a.events.Updated,{tran:c.transform,delta:b})},j.prototype.onMouseDown=function(b){if(!this.transform||this.drawState===a.ui.trans.DrawState.NONE)return!1;var c=b.x,d=b.y,e,f,g;this.xArrow.isInside(c,d)?(this.down=!0,e=hemi.Plane.XY,f=hemi.Axis.Z,g=hemi.Axis.X):this.yArrow.isInside(c,d)?(this.down=!0,e=hemi.Plane.YZ,f=hemi.Axis.X,g=hemi.Axis.Y):this.zArrow.isInside(c,d)&&(this.down=!0,e=hemi.Plane.XZ,f=hemi.Axis.Y,g=hemi.Axis.Z);if(this.down){switch(this.drawState){case a.ui.trans.DrawState.ROTATE:this.startRotate(f,b);break;case a.ui.trans.DrawState.SCALE:this.startScale(g,b);break;case a.ui.trans.DrawState.TRANSLATE:this.startTranslate(e,b)}return!0}return!1},j.prototype.onMouseMove=function(b){if(!this.transform||this.drawState===a.ui.trans.DrawState.NONE)return!1;this.down&&this.manip.onMouseMove(b);var c=b.x,d=b.y,e=!1;this.xArrow.hover=!1,this.yArrow.hover=!1,this.zArrow.hover=!1,this.xArrow.isInside(c,d)?e=this.xArrow.hover=!0:this.yArrow.isInside(c,d)?e=this.yArrow.hover=!0:this.zArrow.isInside(c,d)&&(e=this.zArrow.hover=!0);return e},j.prototype.onMouseUp=function(b){if(!this.down)return!1;this.down=!1,this.manip&&(this.transform.cancelInteraction(),this.manip=null),a.client.camera.enableControl();return!0},j.prototype.onRender=function(b){this.drawState!==a.ui.trans.DrawState.NONE&&this.transform!==null&&(hemi.hudManager.clearDisplay(),this.drawCallback&&this.drawCallback(),this.drawHandles())},j.prototype.overrideHandlers=function(){var a=hemi.input.mouseDown,b=hemi.input.mouseUp,c=hemi.input.mouseMove,d=this,e=this.canvas.canvas;e.removeEventListener("mousedown",a,!0),e.removeEventListener("mousemove",c,!0),e.removeEventListener("mouseup",b,!0),this.mouseDownHandler=function(b){var c=hemi.utils.clone(b,!1);d.convertEvent(c),d.onMouseDown(c)||a(b)},this.mouseUpHandler=function(a){var c=hemi.utils.clone(a,!1);d.convertEvent(c),d.onMouseUp(c)||b(a)},this.mouseMoveHandler=function(a){var b=hemi.utils.clone(a,!1);d.convertEvent(b),d.onMouseMove(b)||c(a)},e.addEventListener("mousedown",this.mouseDownHandler,!0),e.addEventListener("mousemove",this.mouseMoveHandler,!0),e.addEventListener("mouseup",this.mouseUpHandler,!0),jQuery(document).bind("mouseup.transhandles",function(a){d.onMouseUp(a)})},j.prototype.setDrawCallback=function(a){this.drawCallback=a},j.prototype.setDrawState=function(b){b===a.ui.trans.DrawState.NONE&&hemi.hudManager.clearDisplay(),this.drawState=b,this.onRender()},j.prototype.setTransform=function(a){this.transform=a,this.onRender()},j.prototype.startRotate=function(b,c){a.client.camera.disableControl(),f._manip=f.cancelInteraction(),f.setTurnable(b,null,[this.transform]),this.manip=f._manip,this.manip.onPick(this.transform,c)},j.prototype.startScale=function(b,c){a.client.camera.disableControl(),f._manip=f.cancelInteraction(),f.setResizable(b,[this.transform]),this.manip=f._manip,this.transform.subscribe(hemi.msg.resize,this,"onChange",[hemi.dispatch.MSG_ARG+"data.scale"]),c.shiftKey&&(this.manip.axis=e),this.manip.onPick(this.transform,c)},j.prototype.startTranslate=function(b,c){a.client.camera.disableControl(),f._manip=f.cancelInteraction();var d;switch(b){case hemi.Plane.XY:d=[null,null,0,0];break;case hemi.Plane.YZ:d=[0,0,null,null];break;case hemi.Plane.XZ:d=[0,0,null,null]}f.setMovable(b,d,[this.transform]),this.manip=f._manip,this.manip.name=a.ToolConstants.EDITOR_PREFIX+"Dragger",this.transform.subscribe(hemi.msg.move,this,"onChange",[hemi.dispatch.MSG_ARG+"data.delta"]),this.manip.onPick(this.transform,c)};var k=function(a,b,c){this.canvas=a,this.clr=b,this.hvrClr=c};k.prototype.isInside=function(a,b){return a>=this.topLeft[0]&&a<=this.bottomRight[0]&&b>=this.topLeft[1]&&b<=this.bottomRight[1]},k.prototype.drawLine=function(){var a=this.canvas,b=this.config;a.beginPath(),a.moveTo(b.orgPnt.x,b.orgPnt.y),a.lineTo(b.endPnt.x,b.endPnt.y),a.strokeStyle=this.hover?this.hvrClr:this.clr,a.lineWidth=b.lineWidth,a.stroke()},k.prototype.drawRotater=function(){var b=this.config,c=b.origin,d=b.vector,e=Math.PI/90,f=Math.PI/2,g=b.extent,h=[f-e*3,f-e*2,f-e,f,f+e,f+e*2,f+e*3],i=this.canvas,j,k;i.beginPath();for(var l=0,m=h.length;l<m;l++){var n=h[l],o=c.clone();switch(b.plane){case hemi.Plane.XY:o.y=c.y+g*Math.cos(n),o.x=c.x+g*Math.sin(n);break;case hemi.Plane.YZ:o.z=c.z+g*Math.cos(n),o.y=c.y+g*Math.sin(n);break;case hemi.Plane.XZ:o.x=c.x+g*Math.cos(n),o.z=c.z+g*Math.sin(n)}o=hemi.utils.worldToScreen(a.client,o),l===0?(i.moveTo(o.x,o.y),j=o):l===m-1&&(k=o),i.lineTo(o.x,o.y)}i.strokeStyle=this.hover?this.hvrClr:this.clr,i.lineWidth=b.lineWidth*3,i.lineCap="round",i.stroke();var p=j.x,q=k.x,r=j.y,s=k.y,t=Math.min(p,q),u=Math.min(r,s),v=Math.max(p,q),w=Math.max(r,s);Math.abs(p-q)<5&&(v=t+5),Math.abs(r-s)<5&&(w=u+5),this.topLeft=[t,u],this.bottomRight=[v,w]},k.prototype.drawScaler=function(){var b=a.client,c=this.config,d=c.origin,e=c.vector,f=c.extent/8,g=[],h=this.canvas,i=this.hover?this.hvrClr:this.clr,j=function(a,b,c){var d=e.clone(),g=[];d[a]=d[a]+f/2,d[b]=d[b]+f/2,g.push(d);var h=d.clone();h[b]-=f,g.push(h);var i=h.clone();i[a]-=f,g.push(i);var j=i.clone();j[b]+=f,g.push(j);var k=j.clone();k[c]+=f,g.push(k),k=i.clone(),k[c]+=f,g.push(k),k=h.clone(),k[c]+=f,g.push(k),k=d.clone(),k[c]+=f,g.push(k);return g},k=function(a,b,c,d){h.beginPath(),h.moveTo(a.x,a.y),h.lineTo(b.x,b.y),h.lineTo(c.x,c.y),h.lineTo(d.x,d.y),h.lineTo(a.x,a.y),h.closePath(),h.fillStyle=i,h.fill()};switch(c.plane){case hemi.Plane.XY:g=j("y","z","x");break;case hemi.Plane.YZ:g=j("z","x","y");break;case hemi.Plane.XZ:g=j("x","y","z")}var l,m,n,o;l=m=1e7,n=o=-1e7;for(var p=0,q=g.length;p<q;p++){var r=hemi.utils.worldToScreen(b,g[p].clone());l=Math.min(l,r.x),m=Math.min(m,r.y),n=Math.max(n,r.x),o=Math.max(o,r.y)}var s=hemi.utils.worldToScreen(b,g[0]),t=hemi.utils.worldToScreen(b,g[1]),u=hemi.utils.worldToScreen(b,g[2]),v=hemi.utils.worldToScreen(b,g[3]),w=hemi.utils.worldToScreen(b,g[4]),x=hemi.utils.worldToScreen(b,g[5]),y=hemi.utils.worldToScreen(b,g[6]),z=hemi.utils.worldToScreen(b,g[7]);k(s,t,u,v),k(s,z,w,v),k(s,t,y,z),k(z,y,x,w),k(y,x,v,u),k(v,u,x,w),this.topLeft=[l,m],this.bottomRight=[n,o]},k.prototype.drawTranslator=function(){var b=a.client,c=this.config,d=c.origin,e=c.vector,f=Math.PI/30,g=Math.PI/2,h=c.extent/20,i=e.clone(),j=60,k=0,l=[],m=c.extent/5,n=this.canvas,o=this.hover?this.hvrClr:this.clr,p="x",q="x",r=function(a){var b=0,c={pnt1:a[0],pnt2:a[0]};for(var d=0,e=j;d<e;d++){var f=a[d],g=a[(d+j/2)%j],h=f.distanceTo(g);h>b&&(b=h,c.pnt1=f,c.pnt2=g)}return c};switch(c.plane){case hemi.Plane.XY:i.x=e.x+m,p="y",q="z";break;case hemi.Plane.YZ:i.y=e.y+m,p="z";break;case hemi.Plane.XZ:i.z=e.z+m,p="y"}i=hemi.utils.worldToScreen(b,i),n.beginPath();for(var s=0;s<j;s++){var t=e.clone();k=k+=f,t[p]=e[p]+h*Math.cos(k),t[q]=e[q]+h*Math.sin(k),t=hemi.utils.worldToScreen(b,t),s===0&&n.moveTo(t.x,t.y),n.lineTo(t.x,t.y),l.push(t)}n.closePath(),n.fillStyle=o,n.fill();var u=r(l),v=u.pnt1,w=u.pnt2,x=Math.max(v.x,w.x,i.x),y=Math.max(v.y,w.y,i.y),z=Math.min(v.x,w.x,i.x),A=Math.min(v.y,w.y,i.y);n.beginPath(),n.moveTo(v.x,v.y),n.lineTo(w.x,w.y),n.lineTo(i.x,i.y),n.closePath(),n.fillStyle=o,n.fill(),this.topLeft=[z,A],this.bottomRight=[x,y]},k.prototype.setParams=function(b,c,d,e,f){var g=a.client,h=hemi.utils.worldToScreen(g,c.clone()),i=hemi.utils.worldToScreen(g,b.clone()),j=i.distanceTo(h),k=a.client.camera.getEye(),l=(new THREE.Vector3).sub(k,b).normalize(),m=(new THREE.Vector3).sub(c,b).normalize(),n=this.config;if(!isNaN(l.x)&&!isNaN(m.x)){this.config={origin:b,vector:c,orgPnt:i,endPnt:h,distance:j,centerEye:l,centerArrow:m,plane:d,extent:f,lineWidth:3},this.drawLine();switch(e){case a.ui.trans.DrawState.TRANSLATE:this.drawTranslator();break;case a.ui.trans.DrawState.ROTATE:this.drawRotater();break;case a.ui.trans.DrawState.SCALE:this.drawScaler()}}}}(editor),function(a){a.ui=a.ui||{},a.ui.GridPlane=function(a,b,c){this.extent=b,this.fidelity=c,this.client=a,this.createShape()},a.ui.GridPlane.prototype.createShape=function(){var a=new THREE.MeshPhongMaterial({color:6710886,opacity:.2,wireframe:!0}),b=new THREE.MeshPhongMaterial({color:6710886,lighting:!1,opacity:.5,wireframe:!0}),c=this.extent/this.fidelity,d=this.extent*2,e=this.fidelity*5,f=this.extent/e,g=new THREE.Mesh(new THREE.PlaneGeometry(d,d,c,c),a),h=new THREE.Mesh(new THREE.PlaneGeometry(d,d,f,f),b);coloredPlane=new THREE.Mesh(new THREE.PlaneGeometry(d,d),new THREE.MeshBasicMaterial({color:7721204,opacity:.1,transparent:!0})),this.transform=new THREE.Object3D,this.transform.add(g),this.transform.add(h),this.transform.add(coloredPlane),coloredPlane.translateZ(-0.1),this.material=a,this.markerMaterial=b,this.client.scene.add(this.transform),coloredPlane.doubleSided=!0,hemi.utils.centerGeometry(coloredPlane)},a.ui.GridPlane.prototype.setClient=function(a){this.client=a,this.createShape()},a.ui.GridPlane.prototype.setVisible=function(a){var b=this.transform.children;for(var c=0;c<b.length;++c)b[c].visible=a}}(editor),function(a){"use strict",a.ui=a.ui||{};var b=function(a,b){var c=jQuery('<div title="'+b+'" id="'+a+'Dlg" class="simpleDialog">\n\t\t\t\t<p></p>\n\t\t\t\t<form method="post" action="">\n\t\t\t\t\t<label></label>\n\t\t\t\t</form>\n\t\t\t</div>'),d=c.find("form").submit(function(){return!1}),e=c.find("p").hide(),f=c.find("label");c.data("msg",e).data("label",f).data("form",d);return c};a.ui.createDependencyDialog=function(a){var c=b("showDeps","Unable to Remove"),d=c.data("form").attr("style","float:none;"),e=c.data("msg").attr("style","text-align:left;"),f=jQuery('<p style="text-align:left;" id="depList"></p>'),g=jQuery('<button id="okayBtn">Okay</button>');d.append(f),c.append(g),e.text("The following elements depend on this element either directly\n\t\t\t\tor indirectly. Please remove or modify them first."),f.html(a),g.click(function(){c.dialog("close")}),c.dialog({width:300,resizable:!1,autoOpen:!1,modal:!0}).bind("dialogopen",function(){d.show(),e.show()});return c}}(editor),function(a){function l(a){var b=jQuery("<li></li>");b.append(a.getUI()).data("component",a);return b}function h(a,b){var c=null,d=b.indexOf(a);if(d!=-1){var e=b.splice(d,1);e.length==1&&(c=e[0])}return c}function g(){var a=null;for(var b=0,c=this.tools.length;b<c&&a==null;b++){var d=this.tools[b];d.enabled&&(a=d.tool)}return a}function f(b){var c=!1;for(var d=0,f=this.tools.length;d<f&&!c;d++){var h=this.tools[d];h.tool===b.item&&(h.enabled=b.enabled,c=!0)}if(!b.enabled){b.item.setMode(a.ToolConstants.MODE_UP);if(!e.call(this))this.notifyListeners(a.events.Enabled,{item:this,enabled:!1});else if(!this.hidden){var i=g.call(this);this.hidden||i.setMode(a.ToolConstants.MODE_DOWN),this.header.text(i.toolTitle)}}else!this.hidden&&this.getActiveTool()==null&&b.item.setMode(a.ToolConstants.MODE_DOWN),this.notifyListeners(a.events.Enabled,{item:this,enabled:!0})}function e(){var a=!1;for(var b=0,c=this.tools.length;b<c&&!a;b++)a|=this.tools[b].enabled;return a}"use strict",a.ui=a.ui||{},a.tools=a.tools||{},a.ToolConstants={EDITOR_PREFIX:"EditorCitizen:",MODE_DOWN:"down",MODE_UP:"up"};var b=new Hashtable,c=new Hashtable;a.getModel=function(a){return b.get(a)},a.getModels=function(){return b.values()},a.getView=function(a){return c.get(a)},a.getViews=function(){return c.values()};var d=a.ui.ToolBar=function(b){this.tools=[],this.savedTool=null,this.mousedIn=[],this.hidden=!0,a.ui.Component.call(this)};d.prototype=new a.ui.Component,d.prototype.constructor=d,d.prototype.add=function(b){b instanceof a.ToolView&&(this.tools.push({tool:b,enabled:!0}),this.list.append(l(b)),b.addListener(a.events.ToolClicked,this),b.addListener(a.events.ToolMouseIn,this),b.addListener(a.events.ToolMouseOut,this),b.addListener(a.events.Enabled,this))},d.prototype.layout=function(){this.container=jQuery('<div class="toolbar"></div>'),this.header=jQuery('<h3 class="toolTitle"></h3>'),this.list=jQuery("<ul></ul>"),this.container.append(this.header).append(this.list)},d.prototype.getActiveTool=function(){for(var b=0,c=this.tools.length;b<c;b++){var d=this.tools[b].tool;if(d.mode===a.ToolConstants.MODE_DOWN)return d}return null},d.prototype.loadState=function(){var b=this.savedTool;b==null&&(b=this.tools[0].tool),b.setMode(a.ToolConstants.MODE_DOWN),this.header.text(b.toolTitle),this.hidden=!1},d.prototype.notify=function(b,c){switch(b){case a.events.ToolClicked:var d=this.tools;for(var e=0,g=d.length;e<g;e++){var i=d[e].tool;i!=c&&i.setMode(a.ToolConstants.MODE_UP)}this.header.text(c.toolTitle);break;case a.events.ToolMouseIn:this.header.css("opacity",0),this.mousedIn.push(c);break;case a.events.ToolMouseOut:h(c,this.mousedIn),this.mousedIn.length===0&&this.header.css("opacity",1);break;case a.events.Enabled:f.call(this,c)}},d.prototype.remove=function(a){var a=h(a,this.tools);a.getUI().remove()},d.prototype.saveState=function(){this.savedTool=this.getActiveTool(),this.savedTool&&this.savedTool.setMode(a.ToolConstants.MODE_UP),this.hidden=!0},d.prototype.setEnabled=function(a){for(var b=0,c=this.tools.length;b<c;b++)this.tools[b].setEnabled(a)};var i=a.ToolModel=function(c){a.utils.Listenable.call(this),this.id=c,c&&(b.put(c,this),a.notifyListeners(a.events.ModelAdded,{id:c,model:this}),a.addListener(a.events.WorldCleaned,this),a.addListener(a.events.WorldLoaded,this))};i.prototype=new a.utils.Listenable,i.prototype.constructor=i,i.prototype.getId=function(){return this.id},i.prototype.notify=function(b,c){switch(b){case a.events.WorldCleaned:this.worldCleaned();break;case a.events.WorldLoaded:this.worldLoaded()}},i.prototype.worldCleaned=function(){},i.prototype.worldLoaded=function(){},a.ToolViewDefaults={id:"",toolName:"toolName",toolTip:""};var j=a.ToolView=function(b){a.utils.Listenable.call(this),this.config=jQuery.extend({},a.ToolViewDefaults,b),this.toolTitle=this.config.toolName,this.toolbarContainer=null,this.enabled=!0,this.mode=a.ToolConstants.MODE_UP,this.panels=[],this.visiblePanels=[],this.id=this.config.id,this.id&&(this.layoutToolBarContainer(),c.put(this.id,this),a.notifyListeners(a.events.ViewAdded,{id:this.id,view:this}))};j.prototype=new a.utils.Listenable,j.prototype.constructor=j,j.prototype.setEnabled=function(b){this.enabled!=b&&(this.enabled=b,b?this.toolbarContainer.show():this.toolbarContainer.hide(),this.notifyListeners(a.events.Enabled,{item:this,enabled:b}))},j.prototype.setMode=function(b){var c=this.mode;this.mode=b,this.toolbarContainer&&(this.toolbarContainer.removeClass(c),this.toolbarContainer.addClass(this.mode));switch(b){case a.ToolConstants.MODE_DOWN:for(var d=0,e=this.visiblePanels.length;d<e;d++)this.visiblePanels[d].setVisible(!0);this.visiblePanels=[];break;case a.ToolConstants.MODE_UP:for(var d=0,e=this.panels.length;d<e;d++){var f=this.panels[d];f.isVisible()&&(this.visiblePanels.push(f),f.setVisible(!1))}}this.notifyListeners(a.events.ToolModeSet,{oldMode:c,newMode:b})},j.prototype.getUI=function(){return this.toolbarContainer},j.prototype.layoutToolBarContainer=function(){var b=this,c=["toolBtn",this.id,this.mode];this.toolbarContainer=jQuery('<div class="'+c.join(" ")+'" title="'+this.config.toolTip+'"></div>'),this.toolHover=jQuery('<h3 class="toolHover">'+this.config.toolName+"</h3>").css("zIndex",a.ui.Layer.TOOLBAR),this.toolbarContainer.append(this.toolHover),this.toolbarContainer.bind("click",function(){b.mode!==a.ToolConstants.MODE_DOWN&&(b.notifyListeners(a.events.ToolClicked,b),b.setMode(a.ToolConstants.MODE_DOWN))}).bind("mouseover",function(c){b.mode===a.ToolConstants.MODE_UP&&(b.toolHover.fadeIn(100),b.notifyListeners(a.events.ToolMouseIn,b))}).bind("mouseout",function(c){b.toolHover.promise("fx").done(function(){b.toolHover.fadeOut(100),b.notifyListeners(a.events.ToolMouseOut,b)})})},j.prototype.addPanel=function(a){jQuery.inArray(a,this.panels)===-1&&(this[a.getName()]=a,this.panels.push(a),a.config.startsVisible&&this.visiblePanels.push(a))},j.prototype.removePanel=function(a){var b=this.panels.indexOf(a);b!=-1&&(this.panels.splice(b,1),delete this[a.getName()])};var k=a.ToolController=function(){this.model,this.view};k.prototype.setView=function(a){this.view=a,this.checkBindEvents()&&this.bindEvents()},k.prototype.setModel=function(a){this.model=a,this.checkBindEvents()&&this.bindEvents()},k.prototype.checkBindEvents=function(){return this.model&&this.view},k.prototype.bindEvents=function(){}}(editor),function(a){"use strict";var b=a.projects={},c=null;b.init=function(){var f=new a.ui.NavPane("Project:"),g=new a.ui.ToolBar,h=new m,i=new n;c=new e,i.setModel(c),i.setView(h),g.add(h),f.setToolBar(g),a.ui.addNavPane(f,"prjPane");var j=f.getUI();j.find("a").unbind("click").bind("click",function(){var a=h.buttons.is(":visible");a?h.cancel():(h.notifyListeners(b.events.UpdateProjects),h.showButtons())}),f.setVisible(!0),h.sidePanel.addListener(a.events.PanelVisible,function(b){var c=a.ui.getNavBar().visiblePane;c&&!h.isPreview&&c.setVisible(!b.visible)});var k=a.getModels();for(var l=0,o=k.length;l<o;++l){var p=k[l];p!==c&&(p.addListener(a.events.Created,c),p.addListener(a.events.Removing,c),p.addListener(a.events.Updated,c))}a.addListener(a.events.PluginLoaded,function(b){var d=a.getModel(b);d&&(d.addListener(a.events.Created,c),d.addListener(a.events.Removing,c),d.addListener(a.events.Updated,c))});var q=setInterval(function(){c.dirty&&!c.loading&&(c.save(d,!0),c.dirty=!1)},5e3);jQuery(document).unload(function(){clearInterval(q)})},b.events={CheckProjectExists:"checkProjectExists",Load:"load",Loaded:"loaded",NewProject:"newProject",Projects:"projects",ProjectExists:"projectExsits",Publish:"publish",Published:"published",Save:"save",Saved:"saved",ServerRunning:"serverRunning",StartPreview:"startPreview",StopPreview:"stopPreview",UpdateProjects:"updateProjects"};var d="_AutoSave_",e=function(){a.ToolModel.call(this,"projectLoad");var c=this;this.projectCache=[],this.serverRunning=!0,this.dirty=!1,this.loading=!1,this.current=null,this.worldState=null,jQuery.ajax({url:"/projects",dataType:"json",success:function(a,b,d){c.projectCache=a.projects},error:function(a,d,e){c.serverRunning=!1,c.notifyListeners(b.events.ServerRunning,!1)}})},f=a.ToolModel.prototype;e.prototype=new a.ToolModel,e.prototype.constructor=e,e.prototype.checkExisting=function(a){this.notifyListeners(b.events.ProjectExists,{exists:g.call(this,a)!==-1,project:a})},e.prototype.getProjects=function(){this.notifyListeners(b.events.Projects,this.serverRunning?this.projectCache:null)},e.prototype.load=function(c){var d={name:c},e=a.getDispatchProxy(),f=this;jQuery.ajax({url:"/project",data:d,dataType:"json",success:function(d,g,h){var i=hemi.hudManager._contexts[a.client._getId()];f.loading=!0,hemi.send(hemi.msg.worldCleanup),e.swap(),hemi.fromOctane(d),e.unswap();var j=a.client=hemi.clients[0];a.grid.setClient(j),hemi.hudManager._contexts[j._getId()]=i,hemi.ready(),f.notifyListeners(b.events.Loaded,{project:c,succeeded:!0})},error:function(a,d,e){f.notifyListeners(b.events.Loaded,{project:c,succeeded:!1})}})},e.prototype.newProject=function(){var c=a.client,d=c.scene,e=c.camera,f=hemi.createViewData(e);hemi.world.removeCitizen(c),hemi.world.removeCitizen(d),hemi.world.removeCitizen(e),hemi.world.cleanup(),hemi.ready(),hemi.world.addCitizen(c),hemi.world.addCitizen(d),hemi.world.addCitizen(e),f.eye.set(0,10,40),f.target.set(0,0,0),e.moveToView(f,0),e.enableControl(),this.notifyListeners(b.events.NewProject)},e.prototype.notify=function(b,c){f.notify.call(this,b,c);switch(b){case a.events.Created:case a.events.Removing:case a.events.Updated:this.dirty=!0}},e.prototype.publish=function(a){this.save(a,!0);var c={name:a},d=hemi.world.getModels(),e=this;if(d.length>0){var f=[];for(var h=0,i=d.length;h<i;h++)f.push(d[h].name);c.models=f.join(", ")}else c.models="No models needed!";jQuery.ajax({url:"/publish",data:c,dataType:"json",type:"post",success:function(c,d,f){var h=g.call(e,a);e.projectCache[h].published=!0,e.notifyListeners(b.events.Published,{name:a,published:!0})},error:function(c,d,f){e.notifyListeners(b.events.Published,{name:a,published:!1})}})},e.prototype.remove=function(b){var c={name:b},d=this;jQuery.ajax({url:"/project",data:c,dataType:"json",type:"delete",success:function(c,e,f){d.notifyListeners(a.events.Removing,c.name);var h=g.call(d,b);h!==-1&&d.projectCache.splice(h,1)},error:function(a,b,c){d.serverRunning=!1}})},e.prototype.save=function(c,d){d=d||!1;var e={name:c,octane:JSON.stringify(a.getProjectOctane()),replace:d},f=this;jQuery.ajax({url:"/project",data:e,dataType:"json",type:"post",success:function(a,d,e){f.notifyListeners(b.events.Saved,{project:c,saved:!0}),f.projectCache.push({name:c,published:!1})},error:function(a,d,e){f.serverRunning=!1,f.notifyListeners(b.events.Saved,{project:c,saved:!1})}})},e.prototype.startPreview=function(){if(this.worldState===null){var b=a.getProjectOctane();b=hemi.utils.clone(b),this.worldState={clients:hemi.clients,renderListeners:hemi._resetRenderListeners(),worldId:hemi.world.checkNextId(),citizens:hemi._resetCitizens(),dispatchId:hemi.dispatch.checkNextId(),msgSpecs:hemi._resetMsgSpecs(),keyListeners:hemi._resetKeyListeners(),mouseListeners:hemi._resetMouseListeners(),hudContexts:hemi.hudManager._contexts};for(var c=0,d=this.worldState.renderListeners.length;c<d;++c){var e=this.worldState.renderListeners[c];if(e.isParticleSystem){hemi.addRenderListener(e);break}}hemi.hudManager.clearDisplay(),hemi.clients=[],hemi.hudManager._contexts={},hemi.subscribe(hemi.msg.progress,a.ui.progressUI,"msgUpdate"),hemi.fromOctane(b);var f=hemi.clients[0];hemi.hudManager._contexts[f._getId()]=this.worldState.hudContexts[a.client._getId()],hemi.ready()}},e.prototype.stopPreview=function(){if(this.worldState!==null){var a=this.worldState;hemi.world.cleanup(),hemi.dispatch.cleanup(),hemi.hudManager.clearDisplay(),hemi.clients=a.clients,hemi._resetRenderListeners(a.renderListeners),hemi._resetCitizens(a.citizens),hemi._resetMsgSpecs(a.msgSpecs),hemi._resetKeyListeners(a.keyListeners),hemi._resetMouseListeners(a.mouseListeners),hemi.world.setNextId(a.worldId),hemi.dispatch.setNextId(a.dispatchId),hemi.hudManager._contexts=a.hudContexts,this.worldState=null}};var g=function(a){var b=-1,c=a.toLowerCase();for(var d=0,e=this.projectCache.length;d<e&&b===-1;d++)this.projectCache[d].name.toLowerCase()===c&&(b=d);return b},h=function(){a.ui.EditableListItem.call(this,{editable:!1}),this.versionsHash=new Hashtable},i=a.ui.EditableListItem.prototype;h.prototype=new a.ui.EditableListItem,h.prototype.constructor=h,h.prototype.add=function(b,c){var d=new a.ui.EditableListItem({editable:!1,removeable:!1});d.setText(c),d.attachObject(c),this.bindButtons(d),this.list.add(d),this.versionsHash.put(c,d)},h.prototype.layout=function(){i.layout.call(this);var c=jQuery("<h2>Versions:</h2>"),d=jQuery('<div class="prjListWrapper"></div>'),e=jQuery('<div class="prjListArrow"></div>'),f=this;this.list=new a.ui.List({cssClass:"prjLst",prefix:"prjLst"}),this.publishLink=jQuery('<a class="publish" href="" target="_blank">View Published</a>'),d.append(c).append(this.list.getUI()).hide(),e.hide(),this.container.append(e).append(d),this.removeBtn.before(this.publishLink.hide()),this.title.bind("click",function(){f.notifyListeners(b.events.Load,f.getText())})},h.prototype.remove=function(a){var b=this.versionsHash.remove(a);this.list.remove(b)};var j=function(b){a.ui.ListWidget.call(this,{name:"prjListWidget",listId:"projectList",prefix:"prjLst",title:"Projects",instructions:"Click on a project to load it. Click the 'x' to delete.",height:a.ui.Height.FULL}),this.container.addClass("widgetWithForms")};j.prototype=new a.ui.ListWidget,j.prototype.constructor=e,j.prototype.add=function(a){var b=this.items.get(a.name);b||(b=this.createListItem(),b.setText(a.name),this.bindButtons(b,a),this.list.add(b),this.items.put(a.name,b));return b},j.prototype.bindButtons=function(b,c){var d=this;c.published&&b.publishLink.attr("href","/projects/"+c.name+".html").show(),b.removeBtn.bind("click",function(b){d.notifyListeners(a.events.Remove,c.name)})},j.prototype.createListItem=function(){var a=new h,c=this;a.addListener(b.events.Load,function(a){c.notifyListeners(b.events.Load,a)});return a},j.prototype.remove=function(a){var b=this.items.get(a),c=!1;b&&(this.list.remove(b),this.items.remove(a),c=!0);return c},j.prototype.update=function(a){var b=this.items.get(a.name),c=!1;b&&(a.published&&b.publishLink.attr("href","/projects/"+a.name+".html").show(),c=!0);return c};var k=function(){a.ui.Widget.call(this,{name:"previewWidget",classes:["previewWidget"],height:a.ui.Height.MANUAL})},l=a.ui.Widget.prototype;k.prototype=new a.ui.Widget,k.prototype.constructor=k,k.prototype.layout=function(){l.layout.call(this);var a=this,c=jQuery("<h1>World<span>Editor</span></h1>"),d=jQuery("<h2>Preview Mode</h2>"),e=jQuery("<div></div>");this.stopBtn=jQuery('<button id="prjStopPreviewBtn">Stop Preview</button>'),this.stopBtn.bind("click",function(){a.notifyListeners(b.events.StopPreview)}),e.append(c).append(d),this.container.append(e).append(this.stopBtn)};var m=function(){a.ToolView.call(this,{toolName:"Project:",toolTip:"",id:"projectLoad"}),this.addPanel(new a.ui.Panel({classes:["prjSidePanel"],startsVisible:!1})),this.addPanel(new a.ui.Panel({location:a.ui.Location.TOP,classes:["prjTopPanel"],startsVisible:!1})),this.sidePanel.addWidget(new j),this.topPanel.addWidget(new k)};m.prototype=new a.ToolView,m.prototype.constructor=m,m.prototype.cancel=function(){this.hideButtons(),this.sidePanel.setVisible(!1),this.saveIpt.val("").show().blur(),jQuery(document).unbind("click.prj")},m.prototype.checkSaveable=function(){var a=this.saveIpt.val(),b=a!=="Unsaved Project"&&a!=="";b?(this.saveBtn.removeAttr("disabled"),this.publishBtn.removeAttr("disabled")):(this.saveBtn.attr("disabled","disabled"),this.publishBtn.attr("disabled","disabled"));return b},m.prototype.hideButtons=function(){this.buttons.slideUp(200)},m.prototype.layoutToolBarContainer=function(){var c=this.toolbarContainer=jQuery('<div id="'+this.id+'"> \n\t\t\t\t<p id="prjMsg"></p> \n\t\t\t\t<input type="text" id="prjSaveIpt" value="Unsaved Project" /> \n\t\t\t\t<div class="buttons"> \n\t\t\t\t\t<button id="prjSaveBtn">Save</button> \n\t\t\t\t\t<button id="prjCancelBtn">Cancel</button> \n\t\t\t\t\t<button id="prjPreviewBtn">Preview</button> \n\t\t\t\t\t<button id="prjPublishBtn">Publish</button> \n\t\t\t\t\t<button id="prjNewBtn">New Project</button> \n\t\t\t\t</div> \n\t\t\t</div>'),d=this,e=this.saveIpt=c.find("#prjSaveIpt"),f=this.saveBtn=c.find("#prjSaveBtn"),g=this.cancelBtn=c.find("#prjCancelBtn").hide(),h=this.newBtn=c.find("#prjNewBtn"),i=this.previewBtn=c.find("#prjPreviewBtn"),j=this.publishBtn=c.find("#prjPublishBtn");this.buttons=c.find("div.buttons").hide(),this.msg=c.find("#prjMsg").hide(),g.bind("click",function(){d.cancel()}),h.bind("click",function(){d.notifyListeners(b.events.NewProject)}),i.bind("click",function(c){d.isPreview=!0,d.notifyListeners(b.events.StartPreview),a.ui.getNavBar().setVisible(!1),d.sidePanel.setVisible(!1),d.topPanel.setVisible(!0)}),j.bind("click",function(){d.notifyListeners(b.events.Publish,e.val())}),f.bind("click",function(a){f.hasClass("overwrite")?d.notifyListeners(b.events.Save,{project:e.val(),replace:!0}):d.notifyListeners(b.events.CheckProjectExists,e.val())}),e.bind("keyup",function(a){var b=a.keyCode?a.keyCode:a.which;b==27&&d.cancel(),d.checkSaveable()}).bind("focus",function(a){e.val()==="Unsaved Project"&&e.val(""),d.notifyListeners(b.events.UpdateProjects),d.showButtons()}).bind("blur",function(){if(e.is(":visible")){var a=e.val();a===""&&d.reset()}}),this.checkSaveable()},m.prototype.reset=function(){this.saveIpt.val(this.loadedProject==null?"Unsaved Project":this.loadedProject),this.msg.empty().hide(),this.cancelBtn.hide().removeClass("overwite"),this.saveBtn.text("Save").removeClass("overwrite"),this.saveIpt.removeClass("overwrite").show(),this.checkSaveable()},m.prototype.showButtons=function(){this.buttons.slideDown(200)},m.prototype.stopPreview=function(){var b=this;setTimeout(function(){b.isPreview=!1},0),a.ui.getNavBar().setVisible(!0),this.sidePanel.setVisible(!0),this.topPanel.setVisible(!1)},m.prototype.updateExists=function(a,c){a?(this.msg.empty().html("Already exists.").show(),this.saveIpt.addClass("overwrite"),this.cancelBtn.show().addClass("overwrite"),this.saveBtn.text("Overwrite").addClass("overwrite")):(this.msg.hide(),this.notifyListeners(b.events.Save,{project:c,replace:!1}))},m.prototype.updateLoaded=function(a,b){b?(a===d&&(a="Restored Project"),this.loadedProject=a,this.reset(),this.saveIpt.show().effect("highlight",{color:"#3b5e77"})):(this.saveIpt.show(),this.msg.text("Server Down. Could not load.").show()),this.sidePanel.setVisible(!1),this.hideButtons()},m.prototype.updateNewProject=function(){this.loadedProject=null,this.reset(),this.sidePanel.setVisible(!1),this.hideButtons()},m.prototype.updateProjects=function(a){var b=this.sidePanel.prjListWidget,c=this;b.clear();if(a===null)this.msg.empty().text("Server Down").show(),this.saveIpt.hide();else for(var d=0,e=a.length;d<e;d++)b.add(a[d]);jQuery(document).bind("click.prj",function(a){var b=jQuery(a.target),d=b.parents(".prjSidePanel, #prjPane");d.size()==0&&b.attr("id")!=="prjPane"&&!c.isPreview&&c.cancel()})},m.prototype.updatePublished=function(a){var b=this.sidePanel.prjListWidget;b.update(a)},m.prototype.updateRemoved=function(a){this.loadedProject===a&&(this.loadedProject=null,this.reset())},m.prototype.updateSaved=function(a,b){b?a!==d&&(this.loadedProject=a,this.cancel(),this.saveIpt.effect("highlight",{color:"#3b5e77"})):this.msg.empty().text("Server Down. Could not save.").show()},m.prototype.updateServerRunning=function(a){a||this.msg.empty().text("Server Down.").show()};var n=function(){a.ToolController.call(this)},o=a.ToolController.prototype;n.prototype=new a.ToolController,n.prototype.constructor=n,n.prototype.bindEvents=function(){o.bindEvents.call(this);var c=this.model,d=this.view,e=d.sidePanel.prjListWidget,f=d.topPanel.previewWidget;d.addListener(b.events.CheckProjectExists,function(a){c.checkExisting(a)}),d.addListener(b.events.NewProject,function(){c.newProject()}),d.addListener(b.events.Publish,function(a){c.publish(a)}),d.addListener(b.events.Save,function(a){c.save(a.project,a.replace)}),d.addListener(b.events.StartPreview,function(){c.startPreview()}),d.addListener(b.events.UpdateProjects,function(){c.getProjects()}),e.addListener(b.events.Load,function(a){c.load(a)}),e.addListener(a.events.Remove,function(a){c.remove(a)}),f.addListener(b.events.StopPreview,function(){c.stopPreview(),d.stopPreview()}),c.addListener(b.events.Loaded,function(a){d.updateLoaded(a.project,a.succeeded)}),c.addListener(b.events.NewProject,function(){d.updateNewProject()}),c.addListener(b.events.ProjectExists,function(a){d.updateExists(a.exists,a.project)}),c.addListener(b.events.Projects,function(a){d.sidePanel.setVisible(!0),d.updateProjects(a)}),c.addListener(b.events.Published,function(a){d.updatePublished(a)}),c.addListener(a.events.Removing,function(a){d.updateRemoved(a),e.remove(a)}),c.addListener(b.events.Saved,function(a){d.updateSaved(a.project,a.saved),e.add({name:a.project,published:!1})}),c.addListener(b.events.ServerRunning,function(a){d.updateServerRunning(a)})},b.loadingDone=function(){c.dirty=!1,c.loading=!1}}(editor),function(a){"use strict";var b=a.plugins={};b.init=function(){var b=new a.ui.NavPane("Manage Plugins"),d=new a.ui.ToolBar,e=new c,h=new f,i=new g;i.setModel(e),i.setView(h),d.add(h),b.setToolBar(d),a.ui.addNavPane(b,"plgPane");var j=b.getUI();j.find("a").unbind("click"),j.find("h2").bind("click",function(a){b.setVisible(!b.isVisible()),jQuery(document).bind("click.plg",function(a){var c=jQuery(a.target),d=c.parents("#plgPane"),e=c.parents(".toolBtn").size()>0||c.hasClass("toolBtn"),f=c.parents("#navBar h2").size()>0;d.size()==0&&c.attr("id")!=="plgPane"&&!e&&!f&&(b.setVisible(!1),jQuery(document).unbind("click.plg"))})}),jQuery.get("js/editor/plugins/plugins.json","json").success(function(a,b,c){var d=a.plugins;d==null&&(d=JSON.parse(c.responseText).plugins);if(d!=null)for(var f=0,g=d.length;f<g;f++)e.loadPlugin(d[f])}).error(function(a,b,c){}),jQuery.get("/plugins").success(function(a,b,c){var d=a.plugins;for(var f=0,g=d.length;f<g;f++)e.addPlugin(d[f])}).error(function(a,b,c){})},b.events={Checked:"checked",PluginActive:"pluginActive",PluginAdded:"pluginAdded"};var c=function(){a.ToolModel.call(this,"pluginManager"),this.activePlugins=[],this.loadedPlugins=[],this.plugins=[],this.callbacks=[],this.scripts=new Hashtable,this.models=new Hashtable,this.views=new Hashtable,this.initComplete=!0,a.addListener(a.events.ScriptLoadStart,this),a.addListener(a.events.ScriptLoaded,this),a.addListener(a.events.ModelAdded,this),a.addListener(a.events.ViewAdded,this)};c.prototype=new a.ToolModel,c.prototype.constructor=c,c.prototype.loadingComplete=function(){var a=this.scripts.values(),b=!0;for(var c=0,d=a.length;c<d&&b;c++)b&=a[c];if(b){for(var c=0,d=this.callbacks.length;c<d;c++){var e=this.callbacks[c];e.callback.apply(this,e.params)}this.currentPlugin=null,this.callbacks=[],this.initComplete=!0}},c.prototype.addPlugin=function(a){this.plugins.indexOf(a)===-1&&(this.plugins.push(a),this.notifyListeners(b.events.PluginAdded,a))},c.prototype.loadPlugin=function(c){var d=this;if(this.loadedPlugins.indexOf(c)===-1)a.tools[c]={},a.getScript("js/editor/plugins/"+c+"/"+c+".js"),this.callbacks.push({callback:function(c){d.currentPlugin=c,a.tools[c].init(),a.notifyListeners(a.events.PluginLoaded,c),d.activePlugins.push(c),d.loadedPlugins.push(c),d.plugins.indexOf(c)===-1&&(d.plugins.push(c),d.notifyListeners(a.events.PluginLoaded,c)),d.updatePluginList(),d.notifyListeners(b.events.PluginActive,{plugin:c,active:!0})},params:[c]});else if(this.activePlugins.indexOf(c)===-1){this.activePlugins.push(c);var e=this.views.get(c);for(var f=0,g=e.length;f<g;f++)e[f].setEnabled(!0);this.updatePluginList(),this.notifyListeners(b.events.PluginActive,{plugin:c,active:!0})}},c.prototype.notify=function(b,c){switch(b){case a.events.ScriptLoadStart:this.scripts.put(c,!1),this.initComplete=!1;break;case a.events.ScriptLoaded:this.scripts.put(c,!0),this.loadingComplete();break;case a.events.ModelAdded:if(this.currentPlugin!=null){var d=this.models.get(this.currentPlugin);d==null&&(d=[c.model]),this.models.put(this.currentPlugin,d)}break;case a.events.ViewAdded:if(this.currentPlugin!=null){var e=this.views.get(this.currentPlugin);e==null&&(e=[c.view]),this.views.put(this.currentPlugin,e)}}},c.prototype.removePlugin=function(a){this.activePlugins.splice(this.activePlugins.indexOf(a),1);var c=this.views.get(a);for(var d=0,e=c.length;d<e;d++)c[d].setEnabled(!1);this.notifyListeners(b.events.PluginActive,{plugin:a,active:!1}),this.updatePluginList()},c.prototype.updatePluginList=function(){if(this.initComplete){var a=this,b={plugins:a.activePlugins},c={plugins:JSON.stringify(b)};jQuery.post("/plugins",c,"json").success(function(a,b,c){}).error(function(a,b,c){})}};var d=function(){a.ui.ListItem.call(this)},e=a.ui.ListItem.prototype;d.prototype=new a.ui.ListItem,d.prototype.constructor=d,d.prototype.layout=function(){e.layout.call(this);var a=this;this.title=jQuery("<label></label>"),this.checkbox=jQuery('<input type="checkbox" />'),this.container.append(this.checkbox).append(this.title),this.checkbox.bind("change",function(){a.notifyListeners(b.events.Checked,{plugin:a.title.text(),checked:a.checkbox.prop("checked")})}),this.container.bind("click",function(b){var c=b.target.tagName==="INPUT",d=b.target.tagName==="LABEL";!c&&!d&&a.checkbox.click()})},d.prototype.setChecked=function(a){this.checkbox.prop("checked",a)},d.prototype.setText=function(a){var b="plg_li_"+a;this.title.text(a).attr("for",b),this.checkbox.attr("id",b)};var f=function(){a.ToolView.call(this,{id:"pluginManager",toolName:"Manage Plugins",toolTip:""}),this.listitems=new Hashtable};f.prototype=new a.ToolView,f.prototype.constructor=f,f.prototype.add=function(a){var c=new d,e=this;c.setText(a),c.addListener(b.events.Checked,function(a){e.notifyListeners(b.events.Checked,a)}),this.list.add(c),this.listitems.put(a,c)},f.prototype.layoutToolBarContainer=function(){var b=this.toolbarContainer=jQuery('<div id="'+this.id+'"> </div>');this.list=new a.ui.List,b.append(this.list.getUI())},f.prototype.setActive=function(a,b){this.listitems.get(a).setChecked(b)};var g=function(){a.ToolController.call(this)},h=a.ToolController.prototype;g.prototype=new a.ToolController,g.prototype.constructor=g,g.prototype.bindEvents=function(){h.bindEvents.call(this);var c=this.model,d=this.view;d.addListener(b.events.Checked,function(a){a.checked?c.loadPlugin(a.plugin):c.removePlugin(a.plugin)}),c.addListener(a.events.PluginLoaded,function(a){d.add(a)}),c.addListener(b.events.PluginActive,function(a){d.setActive(a.plugin,a.active)}),c.addListener(b.events.PluginAdded,function(a){d.add(a)})}}(editor)
